<?php   $online_chat_enabled_pre = true; $online_visitors_enabled_pre = true; ?><?php  if ($online_chat_enabled_pre == true || $online_visitors_enabled_pre == true) : ?><?php $canListOnlineUsers = false; $canListOnlineUsersAll = false; $currentUser = erLhcoreClassUser::instance(); if ('0' == 1) { $canListOnlineUsers = $currentUser->hasAccessTo('lhuser', 'userlistonline'); $canListOnlineUsersAll = $currentUser->hasAccessTo('lhuser', 'userlistonlineall'); } $canseedepartmentstats = $currentUser->hasAccessTo('lhuser', 'canseedepartmentstats'); $pendingTabEnabled = erLhcoreClassModelUserSetting::getSetting('enable_pending_list', 1); $activeTabEnabled = erLhcoreClassModelUserSetting::getSetting('enable_active_list', 1); $closedTabEnabled = erLhcoreClassModelUserSetting::getSetting('enable_close_list', 0); $unreadTabEnabled = erLhcoreClassModelUserSetting::getSetting('enable_unread_list', 1); $frontTabsOrder = explode(',', 'dashboard,online_users,online_map'); ?><?php   $browserNotification = (int)erLhcoreClassModelUserSetting::getSetting('new_user_bn',(int)(0)); $soundUserNotification = (int)erLhcoreClassModelUserSetting::getSetting('new_user_sound',(int)(0)); $onlineDepartment = (int)erLhcoreClassModelUserSetting::getSetting('o_department',(int)(0)); $ouserTimeout = (int)erLhcoreClassModelUserSetting::getSetting('ouser_timeout',(int)(3600)); $oupdTimeout = (int)erLhcoreClassModelUserSetting::getSetting('oupdate_timeout',(int)(10)); $omaxRows = (int)erLhcoreClassModelUserSetting::getSetting('omax_rows',(int)(50)); $ogroupBy = (string)erLhcoreClassModelUserSetting::getSetting('ogroup_by','none'); $omapDepartment = (int)erLhcoreClassModelUserSetting::getSetting('omap_depid',0); $omapMarkerTimeout = (int)erLhcoreClassModelUserSetting::getSetting('omap_mtimeout',30); $onlineCheck = (int)'0'; if ($onlineCheck > 0) { $onlineCheck = ",online_user:(ou.last_check_time_ago < " . ($onlineCheck+3) . ")"; } else { $onlineCheck = ''; } ?><div ng-controller="OnlineCtrl as online" ng-init='groupByField = <?php  echo json_encode($ogroupBy)?>;online.maxRows=<?php  echo (int)$omaxRows?>;online.updateTimeout=<?php  echo (int)$oupdTimeout?>;online.userTimeout = <?php  echo (int)$ouserTimeout?>;online.department=<?php  echo (int)$onlineDepartment?>;online.soundEnabled=<?php  echo $soundUserNotification == 1 ? 'true' : 'false'?>;online.notificationEnabled=<?php  echo $browserNotification == 1 ? 'true' : 'false'?>'><div role="tabpanel" id="tabs" ng-cloak><ul class="nav nav-pills" role="tablist"><?php  foreach ($frontTabsOrder as $frontTab) : ?><?php  if (trim($frontTab) == 'online_users' && $online_visitors_enabled_pre == true) : ?><?php  $chat_onlineusers_section_online_users_tab_enabled = true?><?php  if ($chat_onlineusers_section_online_users_tab_enabled == true && $currentUser->hasAccessTo('lhchat', 'use_onlineusers') == true) : ?><li role="presentation"><a href="#onlineusers" aria-controls="onlineusers" role="tab" data-toggle="tab" title="Lista de Visitantes Online"><i class="material-icons mr-0">face</i></a></li><?php  endif;?><?php  elseif (trim($frontTab) == 'online_map' && $online_visitors_enabled_pre == true) : ?><?php  $chat_onlineusers_section_map_online_tab_enabled = true?><?php  if ($chat_onlineusers_section_map_online_tab_enabled == true && $currentUser->hasAccessTo('lhchat', 'use_onlineusers') == true) : ?><li role="presentation"><a id="map-activator" href="#map" aria-controls="map" role="tab" data-toggle="tab" title="Online visitors on map"><i class="material-icons mr-0">place</i></a></li><?php  endif;?><?php  elseif (trim($frontTab) == 'pending_chats') : ?><?php  if ($pendingTabEnabled == true && $online_chat_enabled_pre == true) : ?><li role="presentation"><a title="En espera de confirmación" href="#pendingchats" aria-controls="pendingchats" role="tab" data-toggle="tab"><i class="material-icons chat-pending mr-0">chat</i><span>{{pending_chats.list.length != false && pending_chats.list.length > 0 ? ' ('+pending_chats.list.length+')' : ''}}</span></a></li><?php  endif;?><?php  elseif (trim($frontTab) == 'active_chats') : ?><?php  if ($activeTabEnabled == true && $online_chat_enabled_pre == true) : ?><li role="presentation"><a title="Chats activos" href="#activechats" aria-controls="activechats" role="tab" data-toggle="tab"><i class="material-icons chat-active">chat</i><span>{{active_chats.list.length != false && active_chats.list.length > 0 ? ' ('+active_chats.list.length+')' : ''}}</span></a></li><?php  endif;?><?php  elseif (trim($frontTab) == 'unread_chats') : ?><?php  if ($unreadTabEnabled == true && $online_chat_enabled_pre == true) : ?><li role="presentation"><a title="Mensajes no leídos" href="#unreadchats" aria-controls="unreadchats" role="tab" data-toggle="tab"><i class="material-icons chat-unread mr-0">chat</i><span>{{unread_chats.list.length != false && unread_chats.list.length > 0 ? ' ('+unread_chats.list.length+')' : ''}}</span></a></li><?php  endif;?><?php  elseif (trim($frontTab) == 'closed_chats') : ?><?php  if ($closedTabEnabled == true && $online_chat_enabled_pre == true) : ?><li role="presentation"><a title="Chats cerrados" href="#closedchats" aria-controls="closedchats" role="tab" data-toggle="tab"><i class="material-icons chat-closed mr-0">chat</i><span>{{closed_chats.list.length != false && closed_chats.list.length > 0 ? ' ('+closed_chats.list.length+')' : ''}}</span></a></li><?php  endif;?><?php  elseif (trim($frontTab) == 'dashboard') : ?><?php  if ($online_chat_enabled_pre == true) : ?><li role="presentation"><a href="#dashboard" aria-controls="dashboard" role="tab" data-toggle="tab" title="Escritorio"><i class="material-icons mr-0">info_outline</i></a></li><?php  endif;?><?php  elseif (trim($frontTab) == 'online_operators') : ?><?php  if ($canListOnlineUsers == true || $canListOnlineUsersAll == true) : ?><?php  $chat_lists_online_operators_enabled = true;?><?php  if ($chat_lists_online_operators_enabled == true) : ?><li role="presentation"><a title="Operadores en línea" href="#onlineoperators" aria-controls="onlineoperators" role="tab" data-toggle="tab"><i class="material-icons chat-operators mr-0">account_box</i><span>{{online_op.list.length != false && online_op.list.length > 0 ? ' ('+online_op.list.length+')' : ''}}</span></a></li><?php  endif;?><?php  endif;?><?php  endif;?><?php  endforeach;?></ul><div class="tab-content" ng-cloak><?php  foreach ($frontTabsOrder as $frontTab) : ?><?php  if (trim($frontTab) == 'online_users' && $online_visitors_enabled_pre == true) : ?><div role="tabpanel" class="tab-pane form-group" id="onlineusers"><?php  $chat_onlineusers_section_online_users_enabled = true?><?php  if ($chat_onlineusers_section_online_users_enabled == true && $currentUser->hasAccessTo('lhchat', 'use_onlineusers') == true) : ?><div class="row"><div class="col-sm-2 form-group col-xs-6 pr5"><label id="online-users-count" title="usuarios en línea">{{online.onlineusers.length}}</label><div class="pull-right"><ul class="list-inline pull-right user-settings-list"><li class="li-icon"><a href="#" ng-click="online.disableNewUserSound()"><i class="material-icons" title="Habilitar/deshabilitar el sonido cuando hay una nueva visita">{{online.soundEnabled ? 'volume_up':'volume_off'}}</i></a></li><li class="li-icon"><a href="#" ng-click="online.disableNewUserBNotif()"><i class="material-icons"  title="Habilitar/deshabilitar notificación del navegador cuando hay una nueva visita">{{online.notificationEnabled ? 'visibility' : 'visibility_off'}}</i></a></li></ul></div></div><div class="col-sm-2 form-group col-xs-6 pl5 pr5"><input class="form-control input-sm" ng-model="query" type="text" value="" placeholder="Escriba para buscar"></div><div class="col-sm-2 form-group col-xs-6 pl5 pr5"><select class="form-control input-sm" ng-model="groupByField" title="Agrupar lista por"><option value="none">Agrupar por</option><option value="user_country_name">País del usuario</option><option value="current_page">Página</option><option value="page_title">Título de la página</option><option value="referrer">Referido de</option><option value="identifier">Identificador</option><option value="dep_id">Departamento</option></select></div><div class="col-sm-2 form-group col-xs-6 pl5 pr5"><?php   echo erLhcoreClassRenderHelper::renderCombobox( array ( 'input_name' => 'department_id', 'optional_field' => 'Selecciona departamento', 'selected_id' => 0, 'css_class' => 'form-control input-sm', 'ng-model' => 'online.department', 'list_function' => 'erLhcoreClassModelDepartament::getList', 'list_function_params' => $departmentParams )); ?></div><div class="col-sm-2 form-group col-xs-6 pl5 pr5"><select class="form-control input-sm" id="updateTimeout" ng-model="online.updateTimeout" title="Actualice la lista cada"><option value="1">1 segundo</option><option value="3">3 segundos</option><option value="5">5 segundos</option><option value="10">10 segundos</option></select></div><div class="col-sm-1 form-group col-xs-6 pl5 pr5"><select class="form-control input-sm" id="userTimeout" ng-model="online.userTimeout" title="Mostrar a los visitantes que visitaron el sitio en el pasado"><option value="30">30 segundos</option><option value="60">1 minuto</option><option value="120">2 minutos</option><option value="300">5 minutos</option><option value="600">10 minutos</option><option value="1200">20 minutos</option><option value="1800">30 minutos</option><option value="3600">1 hora</option><option value="86400">1 día</option><option value="604800">7 días</option><option value="2678400">31 día</option></select></div><div class="col-sm-1 form-group col-xs-12 pl5"><select class="form-control input-sm" id="maxRows" ng-model="online.maxRows" title="Cantidad máxima de datos a mostrar"><option value="50">50</option><option value="100">100</option><option value="150">150</option><option value="200">200</option><option value="250">250</option><option value="300">300</option><option value="500">500</option><option value="1000">1000</option></select></div></div><table ng-cloak class="table table-condensed online-users-table" cellpadding="0" cellspacing="0" ng-init='trans = <?php  echo json_encode(array('third' => 'El usuario no ha visto un mensaje del operador o la ventana del mensaje sigue abierta.','msg_seen' => 'Visto','msg_not_seen' => 'No Visto','second' => 'El usuario ha visto el mensaje del operador.','first' => 'El usuario no tiene ningún mensaje del operador'),JSON_HEX_APOS)?>'><thead><tr><th width="50%" colspan="2"><a class="material-icons" ng-click="online.predicate = 'last_visit'; online.reverse=!online.reverse" title="Última actividad" >access_time</a><a class="material-icons" ng-click="online.predicate = 'time_on_site'; online.reverse=!online.reverse" title="Tiempo en el sitio">access_time</a><a class="material-icons" ng-click="online.predicate = 'visitor_tz_time'; online.reverse=!online.reverse" title="Hora local del visitante">access_time</a><?php  if ('0' == 1) : ?><a class="material-icons" ng-click="online.predicate = 'last_check_time'; online.reverse=!online.reverse" title="Por estado del usuario en el sitio">access_time</a><?php  endif;?><a href="" ng-click="online.predicate = 'current_page'; online.reverse=!online.reverse" />Página</a> | <a href="" ng-click="online.predicate = 'referrer'; online.reverse=!online.reverse" />Vino de</a></th><th width="1%">Acción</th></tr></thead><tbody ng-repeat="group in onlineusersGrouped track by group.id"><tr ng-show="group.label != ''"><td colspan="6"><h5 class="group-by-{{groupByField}}">{{group.label}} ({{group.ou.length}})</h5></td></tr><tr ng-repeat="ou in group.ou | orderBy:online.predicate:online.reverse | filter:query track by ou.id" ng-class="{recent_visit:(ou.last_visit_seconds_ago < 15)<?php  echo $onlineCheck?>}"><td nowrap><div>{{ou.lastactivity_ago}} hace<br/><span class="fs-11">{{ou.time_on_site_front}}</span></div></td><td><div class="btn-group" role="group" aria-label="..."><a class="btn btn-xs btn-default" ng-class="{'icon-user-away': ou.online_status == 1, 'icon-user-online': ou.online_status == 0}" data-popover-content="popover-content-ou" data-popover-title="popover-title-ou" data-chat-id="{{ou.id}}" data-toggle="popover" data-placement="right" ng-click="online.showOnlineUserInfo(ou.id)"><i class="material-icons">info_outline</i><img ng-if="ou.user_country_code != ''" ng-src="/chat/lhc_web/design/defaulttheme/images/flags/{{ou.user_country_code}}.png" alt="{{ou.user_country_name}}" /></a><?php   ?><span ng-click="online.previewChat(ou)" class="btn btn-xs btn-success action-image" ng-show="ou.chat_id > 0"><i class="material-icons">chat</i>Chat</span><span class="btn btn-xs btn-info" ng-show="ou.total_visits > 1"><i class="material-icons">face</i>Recurrente ({{ou.total_visits}})</span><span class="btn btn-success btn-xs" ng-show="ou.total_visits == 1"><i class="material-icons">face</i>Nuevo</span><span title="{{ou.operator_user_string}} ha enviado un mensaje al usuario" class="btn btn-xs" ng-show="ou.operator_message != ''" ng-class="ou.message_seen == 1 ? 'btn-success' : 'btn-danger'"><i class="material-icons">chat_bubble_outline</i>{{ou.message_seen == 1 ? trans.msg_seen : trans.msg_not_seen}}</span><span class="btn btn-xs btn-primary up-case-first" ng-if="ou.user_country_code != ''">{{ou.user_country_name}}{{ou.city != '' ? ' | '+ou.city : ''}}</span><span class="btn btn-primary btn-xs"><i class="material-icons">access_time</i>{{ou.visitor_tz}} - {{ou.visitor_tz_time}}</span></div><div id="popover-title-ou-{{ou.id}}" class="hide" ng-if="ou.user_country_code != ''"><span class="up-case-first"><i class="material-icons">place</i> {{ou.user_country_name}}{{ou.city != '' ? ' | '+ou.city : ''}}</span></div><div id="popover-content-ou-{{ou.id}}" class="hide"><ul class="list-unstyled"><li><i class="material-icons">access_time</i>{{ou.visitor_tz}} - {{ou.visitor_tz_time}}</li><li>{{ou.notes_intro}}<li><i class="material-icons">access_time</i>{{ou.first_visit_front}} - primera visita<li><i class="material-icons">access_time</i>{{ou.last_visit_front}} - última visita<li><i class="material-icons">&#xE8A0;</i>Páginas Vistas - {{ou.pages_count}} {{ou.identifier != '' ? ' Identifier - '+ou.identifier : ''}} | Última actividad {{ou.lastactivity_ago}} hace | Tiempo en el sitio <span class="fs-11">{{ou.time_on_site_front}}</span><li><i class="material-icons">&#xE1B1;</i>{{ou.user_agent}} | IP: {{ou.ip}}</ul></div><div class="abbr-list pt5" ng-if="ou.page_title || ou.current_page"><i class="material-icons" title="Página">&#xE8A0;</i><a target="_blank" href="{{ou.current_page}}" title="{{ou.current_page}}">{{ou.page_title || ou.current_page}}</a></div><div class="abbr-list pt5" ng-if="ou.referrer != ''"><i class="material-icons" title="De">&#xE8A0;</i><a target="_blank" href="http:{{ou.referrer}}" title="{{ou.referrer}}">{{ou.referrer}}</a></div></td><td><div style="width:90px"><div class="btn-group" role="group" aria-label="..."><?php  $system_configuration_proactive_enabled = true;?><?php  if ($system_configuration_proactive_enabled == true) : ?><a ng-click="online.sendMessage(ou.id)" class="btn btn-default btn-sm material-icons mat-100 mr-0" title="Enviar mensaje">chat</a><?php  endif;?><a ng-click="online.deleteUser(ou,'¿Está seguro?');" class="btn btn-danger btn-sm material-icons mat-100 mr-0" title="Borrar, ID - {{ou.id}}">delete</a></div></div></td></tr></tbody></table><?php  endif;?></div><?php  elseif (trim($frontTab) == 'online_map' && $online_visitors_enabled_pre == true) : ?><div role="tabpanel" class="tab-pane form-group" id="map"><?php  $chat_onlineusers_section_map_online_enabled = true?><?php  if ($chat_onlineusers_section_map_online_enabled == true) : ?><div class="row form-group"><div class="col-xs-6"><img data-toggle="tooltip" data-placement="bottom" class="tip-right" title="El usuario tiene un chat activo" src="/chat/lhc_web/design/defaulttheme/images/icons/home-chat.png" /><img data-toggle="tooltip" data-placement="bottom" class="tip-right" title="El usuario no tiene ningún mensaje del operador" src="/chat/lhc_web/design/defaulttheme/images/icons/home-unsend.png" /><img data-toggle="tooltip" data-placement="bottom" class="tip-right" title="El usuario tiene un mensaje del operador" src="/chat/lhc_web/design/defaulttheme/images/icons/home-send.png" /></div><div class="col-xs-3"><?php  echo erLhcoreClassRenderHelper::renderCombobox( array ( 'input_name' => 'department_map_id', 'optional_field' => 'Selecciona departamento', 'selected_id' => $omapDepartment, 'css_class' => 'form-control input-sm', 'list_function' => 'erLhcoreClassModelDepartament::getList' )); ?></div><div class="col-xs-3"><select class="form-control input-sm" id="markerTimeout" title="Tiempo de espera antes de que el marcador desaparezca del mapa"><option value="30" <?php  echo $omapMarkerTimeout == 30 ? 'selected="selected"' : ''?> >30 segundos</option><option value="60" <?php  echo $omapMarkerTimeout == 60 ? 'selected="selected"' : ''?> >1 minuto</option><option value="120" <?php  echo $omapMarkerTimeout == 120 ? 'selected="selected"' : ''?> >2 minutos</option><option value="300" <?php  echo $omapMarkerTimeout == 300 ? 'selected="selected"' : ''?> >5 minutos</option><option value="600" <?php  echo $omapMarkerTimeout == 600 ? 'selected="selected"' : ''?> >10 minutos</option></select></div></div><div id="map_canvas" style="height:600px;width:100%;"></div><script type="text/javascript">var GeoLocationData = {zoom:<?php  echo $geo_location_data['zoom']?>,lat:<?php  echo $geo_location_data['lat']?>,lng:<?php  echo $geo_location_data['lng']?>};</script><script async defer src="https://maps.googleapis.com/maps/api/js?<?php  if (erConfigClassLhConfig::getInstance()->getSetting( 'site', 'maps_api_key', false)) {echo 'key=' , erConfigClassLhConfig::getInstance()->getSetting( 'site', 'maps_api_key', false) , '&';} elseif (isset($geo_location_data['gmaps_api_key'])) {echo 'key=' ,$geo_location_data['gmaps_api_key'], '&';}?>callback=gMapsCallback"></script>
<?php  endif;?></div><?php  elseif (trim($frontTab) == 'pending_chats' && $online_chat_enabled_pre == true) : ?><?php  if ($pendingTabEnabled == true) : ?><div role="tabpanel" class="tab-pane form-group" id="pendingchats"><div id="pending-chat-list"><ul class="list-unstyled"><li ng-repeat="chat in pending_chats.list track by chat.id" ng-class="{'icon-user-away': chat.user_status_front == 2, 'icon-user-online': chat.user_status_front == 0}"><span ng-if="chat.country_code != undefined"><img ng-src="/chat/lhc_web/design/defaulttheme/images/flags/{{chat.country_code}}.png" alt="{{chat.country_name}}" title="{{chat.country_name}}" /></span><i class="material-icons" ng-show="chat.user_name" title="Operador asignado - {{chat.user_name}}">account_box</i><a class="material-icons" title="ID - {{chat.id}}" ng-click="lhc.previewChat(chat.id)">info_outline</a><a class="material-icons" title="Redirigir usuario al formulario de contacto." ng-click="lhc.redirectContact(chat.id,'¿Está seguro?')" >reply</a><a class="right-action-hide material-icons" ng-click="lhc.startChat(chat.id,chat.nick)" title="Aceptar chat">chat</a><a title="Abrir en una ventana nueva" class="material-icons" ng-click="lhc.startChatNewWindow(chat.id,chat.nick)">open_in_new</a>{{chat.nick}}, <small><i>{{chat.wait_time_pending}},</i></small> {{chat.department_name}}</li></ul><p ng-show="pending_chats.list.length == 0">Vacío...</p></div><a class="btn btn-default btn-sm" href="/chat/lhc_web/index.php/site_admin/chat/list/(chat_status)/0">Todos los chats pendientes</a></div><?php  endif;?><?php  elseif (trim($frontTab) == 'active_chats' && $online_chat_enabled_pre == true) : ?><?php  if ($activeTabEnabled == true) : ?><div role="tabpanel" class="tab-pane form-group" id="activechats"><div id="active-chat-list"><ul class="list-unstyled"><li ng-repeat="chat in active_chats.list track by chat.id" ng-class="{'icon-user-away': chat.user_status_front == 2, 'icon-user-online': chat.user_status_front == 0}"><span ng-if="chat.country_code != undefined"><img ng-src="/chat/lhc_web/design/defaulttheme/images/flags/{{chat.country_code}}.png" alt="{{chat.country_name}}" title="{{chat.country_name}}" /></span><a class="material-icons" title="ID - {{chat.id}}, {{chat.user_name}}" ng-click="lhc.previewChat(chat.id)" >info_outline</a><a class="right-action-hide material-icons" ng-click="lhc.startChat(chat.id,chat.nick)" title="Añadir chat">chat</a><a class="material-icons" ng-click="lhc.startChatNewWindow(chat.id,chat.nick)" title="Abrir en una ventana nueva">open_in_new</a>{{chat.nick}}, <small><i>{{chat.time_created_front}},</i></small> {{chat.department_name}}</li></ul><p ng-show="active_chats.list.length == 0">Vacío...</p></div><a class="btn btn-default btn-sm" href="/chat/lhc_web/index.php/site_admin/chat/list/(chat_status)/1">Todos los chats activos</a></div><?php  endif;?><?php  elseif (trim($frontTab) == 'unread_chats' && $online_chat_enabled_pre == true) : ?><?php  if ($unreadTabEnabled == true) : ?><div role="tabpanel" class="tab-pane form-group" id="unreadchats"><div id="unread-chat-list"><ul class="list-unstyled"><li ng-repeat="chat in unread_chats.list track by chat.id" ng-class="{'icon-user-away': chat.user_status_front == 2, 'icon-user-online': chat.user_status_front == 0}"><span ng-if="chat.country_code != undefined"><img ng-src="/chat/lhc_web/design/defaulttheme/images/flags/{{chat.country_code}}.png" alt="{{chat.country_name}}" title="{{chat.country_name}}" /></span><a class="material-icons" title="ID - {{chat.id}}" ng-click="lhc.previewChat(chat.id)" >info_outline</a><a class="right-action-hide material-icons" ng-click="lhc.startChat(chat.id,chat.nick)" title="Añadir chat">chat</a><a class="material-icons" ng-click="lhc.startChatNewWindow(chat.id,chat.nick)" title="Abrir en una ventana nueva">open_in_new</a>{{chat.nick}}, {{chat.time_created_front}}, {{chat.department_name}} | <b>{{chat.unread_time.hours}} h. {{chat.unread_time.minits}} m. {{chat.unread_time.seconds}} s. hace.</b></li></ul><p ng-show="unread_chats.list.length == 0">Vacío...</p></div><a class="btn btn-default btn-sm" href="/chat/lhc_web/index.php/site_admin/chat/list/(hum)/1">Todos los chats no leídos</a></div><?php  endif;?><?php  elseif (trim($frontTab) == 'closed_chats' && $online_chat_enabled_pre == true) : ?><?php  if ($closedTabEnabled == true) : ?><div role="tabpanel" class="tab-pane form-group" id="closedchats"><div id="closed-chat-list"><ul class="list-unstyled"><li ng-repeat="chat in closed_chats.list track by chat.id" ng-class="{'icon-user-away': chat.user_status_front == 2, 'icon-user-online': chat.user_status_front == 0}"><span ng-if="chat.country_code != undefined"><img ng-src="/chat/lhc_web/design/defaulttheme/images/flags/{{chat.country_code}}.png" alt="{{chat.country_name}}" title="{{chat.country_name}}" /></span><a class="material-icons" title="ID - {{chat.id}}" ng-click="lhc.previewChat(chat.id)" >info_outline</a><a class="right-action-hide material-icons" ng-click="lhc.startChat(chat.id,chat.nick)" title="Añadir chat">chat</a><a class="material-icons" ng-click="lhc.startChatNewWindow(chat.id,chat.nick)" title="Abrir en una ventana nueva">open_in_new</a>{{chat.nick}}, <small><i>{{chat.time_created_front}},</i></small> {{chat.department_name}}</li></ul><p ng-show="closed_chats.list.length == 0">Vacío...</p></div><a class="btn btn-default btn-sm" href="/chat/lhc_web/index.php/site_admin/chat/list/(chat_status)/2">Todos los chats cerrados</a></div><?php  endif;?><?php  elseif (trim($frontTab) == 'dashboard' && $online_chat_enabled_pre == true) : ?><div role="tabpanel" class="tab-pane form-group" id="dashboard"><?php $dashboardOrder = (string)erLhcoreClassModelUserSetting::getSetting('dwo',''); if ($dashboardOrder == '') { $dashboardOrder = 'online_operators,departments_stats|pending_chats,unread_chats,transfered_chats|active_chats,closed_chats'; } $dashboardOrder = explode('|',$dashboardOrder); $columnsTotal = count($dashboardOrder); $columnSize = 12 / $columnsTotal; ?><div class="row" id="dashboard-body" ng-init='lhc.setUpListNames(["actived","closedd","unreadd","pendingd","operatord","departmentd"])'><a class="dashboard-configuration" onclick="return lhc.revealModal({'url':WWW_DIR_JAVASCRIPT +'chat/dashboardwidgets'})" title="Configure dashboard"><i class="material-icons mr-0">&#xE871;</i></a><?php  for ($i = 0; $i < $columnsTotal; $i++) : $widgets = array_filter(explode(',', $dashboardOrder[$i])); ?><div class="col-md-<?php  echo $columnSize+2?> col-lg-<?php  echo $columnSize?> sortable-column-dashboard"><?php  foreach ($widgets as $wiget) : ?><?php  if ($wiget == 'online_operators') : ?><?php  if ($canListOnlineUsers == true || $canListOnlineUsersAll == true) : ?><div class="panel panel-default panel-dashboard" data-panel-id="online_operators" ng-init="lhc.getToggleWidget('ooperators_widget_exp')"><div class="panel-heading"><i class="material-icons chat-active">account_box</i>Operadores Online ({{online_op.list.length}}{{online_op.list.length == lhc.limito ? '+' : ''}})</a><a title="contraer/expandir" ng-click="lhc.toggleWidget('ooperators_widget_exp')" class="fs24 pull-right material-icons exp-cntr">{{lhc.toggleWidgetData['ooperators_widget_exp'] == false ? 'expand_less' : 'expand_more'}}</a></div><div ng-if="lhc.toggleWidgetData['ooperators_widget_exp'] !== true"><?php  $optinsPanel = array('panelid' => 'operatord', 'limitid' => 'limito', 'disable_product' => true); ?><div class="pl10 pr10 pt10"><div class="row"><div class="col-xs-9"><div class="btn-group btn-block btn-block-department"><button type="button" class="btn btn-default btn-block btn-sm dropdown-toggle btn-department-dropdown" data-toggle="dropdown" aria-expanded="false">{{lhc.<?php  echo $optinsPanel['panelid']?>.length == 0 ? "Todos los departamentos" : lhc.<?php  echo $optinsPanel['panelid']?>Names.join(", ")}} <span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li><label><input type="checkbox" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_all_departments"> Check all</label></li><li><label><input type="checkbox" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_only_online"> Only online</label></li><li><label><input type="checkbox" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_only_explicit_online"> Only explicit online</label></li><li><label><input type="checkbox" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_hide_hidden"> Hide hidden</label></li><li class="border-bottom-grey"><label><input data-stopPropagation="true" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" type="checkbox" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_hide_disabled"> Hide disabled</label></li><?php  if (!isset($optinsPanel['disable_product']) || $optinsPanel['disable_product'] == false) : ?><li ng-repeat="product in lhc.userProductNames" data-stopPropagation="true"><label><input type="checkbox" checklist-model="lhc.<?php  echo $optinsPanel['panelid']?>_products" checklist-change="lhc.productChanged('<?php  echo $optinsPanel['panelid']?>_products')" checklist-value="product.id"><i class="material-icons">&#xE8CC;</i>{{product.name}}</label></li><li ng-show="lhc.userProductNames.length > 0" class="border-bottom-grey"></li><?php  endif;?><li ng-repeat="department in lhc.userDepartments" data-stopPropagation="true" ng-hide="( (lhc.<?php  echo $optinsPanel['panelid']?>_only_explicit_online == true && department.oexp == false) || (lhc.<?php  echo $optinsPanel['panelid']?>_hide_hidden == true && department.hidden == true) || (lhc.<?php  echo $optinsPanel['panelid']?>_hide_disabled == true && department.disabled == true) || (lhc.<?php  echo $optinsPanel['panelid']?>_only_online == true && department.ogen == false))"><label><input type="checkbox" checklist-model="lhc.<?php  echo $optinsPanel['panelid']?>" checklist-change="lhc.departmentChanged('<?php  echo $optinsPanel['panelid']?>')" checklist-value="department.id"><i title="Department" class="material-icons">home</i>{{department.name}}</label></li></ul></div></div><div class="col-xs-3"><select class="form-control input-sm" ng-model="lhc.<?php  echo $optinsPanel['limitid']?>" title="Nro de elementos en la lista"><option value="5">5</option><option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select></div></div></div><div class="panel-list"><table class="table table-condensed mb0 table-small table-fixed"><thead><tr><th width="40%"><i title="Operador" class="material-icons">account_box</i></th><th width="15%"><i title="Última actividad hace" class="material-icons">access_time</i></th><th width="15%"><i title="Chats Activos" class="material-icons chat-active">chat</i></th><th width="30%"><i title="Departamento" class="material-icons">home</i></th></tr></thead><tr ng-repeat="operator in online_op.list track by operator.id"><td><a ng-show="operator.user_id != <?php  echo erLhcoreClassUser::instance()->getUserID();?>" href="#" ng-click="lhc.startChatOperator(operator.user_id)" title="Iniciar chat"><i class="material-icons">chat</i></a> {{operator.name_support}}</td><td><div class="abbr-list" title="{{operator.lastactivity_ago}}">{{operator.lastactivity_ago}}</div></td><td>{{operator.active_chats}}</td><td><div class="abbr-list" title="{{operator.departments_names.join(', ')}}">{{operator.departments_names.join(", ")}}</div></td></tr></table></div></div></div><?php  endif;?><?php  elseif ($wiget == 'active_chats') : ?><?php  if ($activeTabEnabled == true && $online_chat_enabled_pre == true) : ?><?php  if ($currentUser->hasAccessTo('lhchat','use')) : ?><div class="panel panel-default panel-dashboard" data-panel-id="active_chats" ng-init="lhc.getToggleWidget('activec_widget_exp')"><div class="panel-heading"><a href="/chat/lhc_web/index.php/site_admin/chat/list/(chat_status)/1"><i class="material-icons chat-active">chat</i> Chats activos ({{active_chats.list.length}}{{active_chats.list.length == lhc.limita ? '+' : ''}})</a><a title="contraer/expandir" ng-click="lhc.toggleWidget('activec_widget_exp')" class="fs24 pull-right material-icons exp-cntr">{{lhc.toggleWidgetData['activec_widget_exp'] == false ? 'expand_less' : 'expand_more'}}</a></div><div ng-if="lhc.toggleWidgetData['activec_widget_exp'] !== true"><?php  $optinsPanel = array('panelid' => 'actived','limitid' => 'limita'); ?><div class="pl10 pr10 pt10"><div class="row"><div class="col-xs-9"><div class="btn-group btn-block btn-block-department"><button type="button" class="btn btn-default btn-block btn-sm dropdown-toggle btn-department-dropdown" data-toggle="dropdown" aria-expanded="false">{{lhc.<?php  echo $optinsPanel['panelid']?>.length == 0 ? "Todos los departamentos" : lhc.<?php  echo $optinsPanel['panelid']?>Names.join(", ")}} <span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li><label><input type="checkbox" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_all_departments"> Check all</label></li><li><label><input type="checkbox" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_only_online"> Only online</label></li><li><label><input type="checkbox" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_only_explicit_online"> Only explicit online</label></li><li><label><input type="checkbox" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_hide_hidden"> Hide hidden</label></li><li class="border-bottom-grey"><label><input data-stopPropagation="true" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" type="checkbox" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_hide_disabled"> Hide disabled</label></li><?php  if (!isset($optinsPanel['disable_product']) || $optinsPanel['disable_product'] == false) : ?><li ng-repeat="product in lhc.userProductNames" data-stopPropagation="true"><label><input type="checkbox" checklist-model="lhc.<?php  echo $optinsPanel['panelid']?>_products" checklist-change="lhc.productChanged('<?php  echo $optinsPanel['panelid']?>_products')" checklist-value="product.id"><i class="material-icons">&#xE8CC;</i>{{product.name}}</label></li><li ng-show="lhc.userProductNames.length > 0" class="border-bottom-grey"></li><?php  endif;?><li ng-repeat="department in lhc.userDepartments" data-stopPropagation="true" ng-hide="( (lhc.<?php  echo $optinsPanel['panelid']?>_only_explicit_online == true && department.oexp == false) || (lhc.<?php  echo $optinsPanel['panelid']?>_hide_hidden == true && department.hidden == true) || (lhc.<?php  echo $optinsPanel['panelid']?>_hide_disabled == true && department.disabled == true) || (lhc.<?php  echo $optinsPanel['panelid']?>_only_online == true && department.ogen == false))"><label><input type="checkbox" checklist-model="lhc.<?php  echo $optinsPanel['panelid']?>" checklist-change="lhc.departmentChanged('<?php  echo $optinsPanel['panelid']?>')" checklist-value="department.id"><i title="Department" class="material-icons">home</i>{{department.name}}</label></li></ul></div></div><div class="col-xs-3"><select class="form-control input-sm" ng-model="lhc.<?php  echo $optinsPanel['limitid']?>" title="Nro de elementos en la lista"><option value="5">5</option><option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select></div></div></div><div ng-if="active_chats.list.length > 0" class="panel-list"><table class="table table-condensed mb0 table-small table-fixed"><thead><tr><th width="60%"><i title="Visitante" class="material-icons">face</i></th><th width="20%"><i title="Operador" class="material-icons">account_box</i></th><th width="20%"><i title="Departamento" class="material-icons">home</i></th></tr></thead><tr ng-repeat="chat in active_chats.list track by chat.id" ng-class="{'user-away-row': chat.user_status_front == 2, 'user-online-row': chat.user_status_front == 0}"><td><div data-toggle="popover" data-placement="top" data-chat-id="{{chat.id}}" class="abbr-list"><span ng-if="chat.country_code != undefined"><img ng-src="/chat/lhc_web/design/defaulttheme/images/flags/{{chat.country_code}}.png" alt="{{chat.country_name}}" title="{{chat.country_name}}" />&nbsp;</span><a title="Abrir en una ventana nueva" class="material-icons" ng-click="lhc.startChatNewWindow(chat.id,chat.nick)">open_in_new</a><a ng-click="lhc.previewChat(chat.id)" class="material-icons">info_outline</a><a ng-click="lhc.startChat(chat.id,chat.nick)" title="{{chat.nick}}"> {{chat.nick}} </a></div><div id="popover-title-{{chat.id}}" class="hide">{{chat.nick}} [{{chat.id}}]</div><div id="popover-content-{{chat.id}}" class="hide"><i class="material-icons">access_time</i>{{chat.time_created_front}}<br /><i class="material-icons">account_box</i>{{chat.plain_user_name}}<br /><i class="material-icons">home</i>{{chat.department_name}}<br /><span ng-show="chat.product_name"><i class="material-icons">&#xE8CC;</i>{{chat.product_name}}</span></div></td><td><div class="abbr-list" title="{{chat.plain_user_name}}">{{chat.plain_user_name}}</div></td><td><div class="abbr-list" title="{{chat.department_name}}{{chat.product_name ? ' | '+chat.product_name : ''}}">{{chat.department_name}}{{chat.product_name ? ' | '+chat.product_name : ''}}</div></td></tr></table></div><div ng-if="active_chats.list.length == 0" class="m10 alert alert-info"><i class="material-icons">search</i>Nada encontrado...</div></div></div><?php  endif; ?><?php  endif;?><?php  elseif ($wiget == 'online_visitors') : ?><?php  if ($online_visitors_enabled_pre == true && $currentUser->hasAccessTo('lhchat', 'use_onlineusers') == true) : ?><div class="panel panel-default panel-dashboard" data-panel-id="online_visitors" ng-init="lhc.getToggleWidget('onvisitors_widget_exp')"><div class="panel-heading"><i class="material-icons">face</i> Visitantes en línea ({{online.onlineusers.length}})<a title="contraer/expandir" ng-click="lhc.toggleWidget('onvisitors_widget_exp')" class="fs24 pull-right material-icons exp-cntr">{{lhc.toggleWidgetData['onvisitors_widget_exp'] == false ? 'expand_less' : 'expand_more'}}</a></div><div ng-if="lhc.toggleWidgetData['onvisitors_widget_exp'] !== true"><div class="p10"><input class="form-control input-sm" ng-model="query" type="text" value="" placeholder="Escriba para buscar"></div><div class="panel-list" ng-if="online.onlineusers.length > 0"><table ng-cloak class="table table-condensed mb0 table-small table-fixed" cellpadding="0" cellspacing="0" ng-init='trans = <?php  echo json_encode(array('third' => 'El usuario no ha visto un mensaje del operador o la ventana del mensaje sigue abierta.','msg_seen' => 'Visto','msg_not_seen' => 'No Visto','second' => 'El usuario ha visto el mensaje del operador.','first' => 'El usuario no tiene ningún mensaje del operador'),JSON_HEX_APOS)?>'><tbody ng-repeat="group in onlineusersGrouped track by group.id"><tr ng-show="group.label != ''"><td colspan="6"><h5 class="group-by-{{groupByField}}">{{group.label}} ({{group.ou.length}})</h5></td></tr><tr ng-repeat="ou in group.ou | orderBy:online.predicate:online.reverse | filter:query track by ou.id" ng-class="{recent_visit:(ou.last_visit_seconds_ago < 15)<?php  echo $onlineCheck?>}"><td><div class="btn-group" role="group" aria-label="..."><a class="btn btn-xs btn-default" ng-class="{'icon-user-away': ou.online_status == 1, 'icon-user-online': ou.online_status == 0}" data-popover-title="popover-title-ou" data-popover-content="popover-content-ou" data-container="body" data-chat-id="{{ou.id}}" data-toggle="popover" data-placement="right" ng-click="online.showOnlineUserInfo(ou.id)"><i class="material-icons">info_outline</i>{{ou.lastactivity_ago}}&nbsp;<img ng-if="ou.user_country_code != ''" ng-src="/chat/lhc_web/design/defaulttheme/images/flags/{{ou.user_country_code}}.png" alt="{{ou.user_country_name}}" /></a><?php   ?><span ng-click="online.previewChat(ou)" class="btn btn-xs btn-success action-image" ng-show="ou.chat_id > 0" title="Preview chat"><i class="material-icons mr0">chat</i></span><span class="btn btn-xs btn-info" ng-show="ou.total_visits > 1"><i class="material-icons">face</i>Visits ({{ou.total_visits}})</span><span class="btn btn-success btn-xs" ng-show="ou.total_visits == 1"><i class="material-icons">face</i>Nuevo</span><span title="{{ou.operator_user_string}} ha enviado un mensaje al usuario" class="btn btn-xs" ng-show="ou.operator_message != ''" ng-class="ou.message_seen == 1 ? 'btn-success' : 'btn-danger'"><i class="material-icons">chat_bubble_outline</i>{{ou.message_seen == 1 ? trans.msg_seen : trans.msg_not_seen}}</span></div><div id="popover-title-ou-{{ou.id}}" class="hide" ng-if="ou.user_country_code != ''"><span class="up-case-first"><i class="material-icons mr-0">place</i> {{ou.user_country_name}}{{ou.city != '' ? ' | '+ou.city : ''}}</span></div><div id="popover-content-ou-{{ou.id}}" class="hide"><ul class="list-unstyled"><li><i class="material-icons">access_time</i>{{ou.visitor_tz}} - {{ou.visitor_tz_time}}</li><li>{{ou.notes_intro}}<li><i class="material-icons">access_time</i>{{ou.first_visit_front}} - primera visita<li><i class="material-icons">access_time</i>{{ou.last_visit_front}} - última visita<li><i class="material-icons">&#xE8A0;</i>Páginas Vistas - {{ou.pages_count}} {{ou.identifier != '' ? ' Identifier - '+ou.identifier : ''}} | Última actividad {{ou.lastactivity_ago}} hace | Tiempo en el sitio <span class="fs-11">{{ou.time_on_site_front}}</span><li><i class="material-icons">&#xE1B1;</i>{{ou.user_agent}} | IP: {{ou.ip}}</ul></div><div class="abbr-list pt5" ng-if="ou.page_title || ou.current_page"><i class="material-icons" title="Página">&#xE8A0;</i><a target="_blank" href="{{ou.current_page}}" title="{{ou.current_page}}">{{ou.page_title || ou.current_page}}</a></div><div class="abbr-list pt5" ng-if="ou.referrer != ''"><i class="material-icons" title="De">&#xE8A0;</i><a target="_blank" href="http:{{ou.referrer}}" title="{{ou.referrer}}">{{ou.referrer}}</a></div></td></tr></tbody></table></div><div ng-if="online.onlineusers.length == 0" class="m10 alert alert-info"><i class="material-icons">search</i>Nada encontrado...</div></div></div><?php  endif;?><?php  elseif ($wiget == 'departments_stats') : ?><?php  if ($online_chat_enabled_pre == true && $canseedepartmentstats == true) : ?><div class="panel panel-default panel-dashboard" data-panel-id="departments_stats" ng-init="lhc.getToggleWidget('dstats_widget_exp')"><div class="panel-heading"><i class="material-icons chat-active">home</i> Estadisticas de Departamentos ({{departments_stats.list.length}}{{departments_stats.list.length == lhc.limitd ? '+' : ''}})</a><?php  if ($currentUser->hasAccessTo('lhstatistic', 'exportxls')) : ?><a class="material-icons" target="_blank" href="/chat/lhc_web/index.php/site_admin/statistic/departmentstatusxls" title="Descargar XLS">file_download</a><?php  endif;?><a title="contraer/expandir" ng-click="lhc.toggleWidget('dstats_widget_exp')" class="fs24 pull-right material-icons exp-cntr">{{lhc.toggleWidgetData['dstats_widget_exp'] == false ? 'expand_less' : 'expand_more'}}</a></div><div ng-if="lhc.toggleWidgetData['dstats_widget_exp'] !== true"><?php  $optinsPanel = array('panelid' => 'departmentd','limitid' => 'limitd', 'disable_product' => true); ?><div class="pl10 pr10 pt10"><div class="row"><div class="col-xs-9"><div class="btn-group btn-block btn-block-department"><button type="button" class="btn btn-default btn-block btn-sm dropdown-toggle btn-department-dropdown" data-toggle="dropdown" aria-expanded="false">{{lhc.<?php  echo $optinsPanel['panelid']?>.length == 0 ? "Todos los departamentos" : lhc.<?php  echo $optinsPanel['panelid']?>Names.join(", ")}} <span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li><label><input type="checkbox" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_all_departments"> Check all</label></li><li><label><input type="checkbox" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_only_online"> Only online</label></li><li><label><input type="checkbox" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_only_explicit_online"> Only explicit online</label></li><li><label><input type="checkbox" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_hide_hidden"> Hide hidden</label></li><li class="border-bottom-grey"><label><input data-stopPropagation="true" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" type="checkbox" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_hide_disabled"> Hide disabled</label></li><?php  if (!isset($optinsPanel['disable_product']) || $optinsPanel['disable_product'] == false) : ?><li ng-repeat="product in lhc.userProductNames" data-stopPropagation="true"><label><input type="checkbox" checklist-model="lhc.<?php  echo $optinsPanel['panelid']?>_products" checklist-change="lhc.productChanged('<?php  echo $optinsPanel['panelid']?>_products')" checklist-value="product.id"><i class="material-icons">&#xE8CC;</i>{{product.name}}</label></li><li ng-show="lhc.userProductNames.length > 0" class="border-bottom-grey"></li><?php  endif;?><li ng-repeat="department in lhc.userDepartments" data-stopPropagation="true" ng-hide="( (lhc.<?php  echo $optinsPanel['panelid']?>_only_explicit_online == true && department.oexp == false) || (lhc.<?php  echo $optinsPanel['panelid']?>_hide_hidden == true && department.hidden == true) || (lhc.<?php  echo $optinsPanel['panelid']?>_hide_disabled == true && department.disabled == true) || (lhc.<?php  echo $optinsPanel['panelid']?>_only_online == true && department.ogen == false))"><label><input type="checkbox" checklist-model="lhc.<?php  echo $optinsPanel['panelid']?>" checklist-change="lhc.departmentChanged('<?php  echo $optinsPanel['panelid']?>')" checklist-value="department.id"><i title="Department" class="material-icons">home</i>{{department.name}}</label></li></ul></div></div><div class="col-xs-3"><select class="form-control input-sm" ng-model="lhc.<?php  echo $optinsPanel['limitid']?>" title="Nro de elementos en la lista"><option value="5">5</option><option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select></div></div></div><div class="panel-list"><table class="table table-condensed mb0 table-small table-fixed"><thead><tr><th width="60%"><i title="Departamento" class="material-icons">home</i></th><th width="20%"><i title="Chats pendientes" class="material-icons chat-pending">chat</i></th><th width="20%"><i title="Chats Activos" class="material-icons chat-active">chat</i></th></tr></thead><tr ng-repeat="department in departments_stats.list track by department.id"><td><div class="abbr-list" title="{{department.name}}">{{department.name}}</div></td><td>{{department.pending_chats_counter ? department.pending_chats_counter : 0}}</td><td>{{department.active_chats_counter ? department.active_chats_counter : 0}}</td></tr></table></div></div></div><?php  endif;?><?php  elseif ($wiget == 'pending_chats') : ?><?php  if ($pendingTabEnabled == true && $online_chat_enabled_pre == true) : ?><?php  if ($currentUser->hasAccessTo('lhchat','use')) : ?><div class="panel panel-default panel-dashboard" data-panel-id="pending_chats" ng-init="lhc.getToggleWidget('pchats_widget_exp');lhc.getToggleWidget('pending_chats_sort')"><div class="panel-heading"><a href="/chat/lhc_web/index.php/site_admin/chat/list/(chat_status)/0"><i class="material-icons chat-pending">chat</i> Chats pendientes ({{pending_chats.list.length}}{{pending_chats.list.length == lhc.limitp ? '+' : ''}})</a><a title="contraer/expandir" ng-click="lhc.toggleWidget('pchats_widget_exp')" class="fs24 pull-right material-icons exp-cntr">{{lhc.toggleWidgetData['pchats_widget_exp'] == false ? 'expand_less' : 'expand_more'}}</a></div><div ng-if="lhc.toggleWidgetData['pchats_widget_exp'] !== true"><?php  $optinsPanel = array('panelid' => 'pendingd','limitid' => 'limitp'); ?><div class="pl10 pr10 pt10"><div class="row"><div class="col-xs-9"><div class="btn-group btn-block btn-block-department"><button type="button" class="btn btn-default btn-block btn-sm dropdown-toggle btn-department-dropdown" data-toggle="dropdown" aria-expanded="false">{{lhc.<?php  echo $optinsPanel['panelid']?>.length == 0 ? "Todos los departamentos" : lhc.<?php  echo $optinsPanel['panelid']?>Names.join(", ")}} <span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li><label><input type="checkbox" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_all_departments"> Check all</label></li><li><label><input type="checkbox" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_only_online"> Only online</label></li><li><label><input type="checkbox" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_only_explicit_online"> Only explicit online</label></li><li><label><input type="checkbox" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_hide_hidden"> Hide hidden</label></li><li class="border-bottom-grey"><label><input data-stopPropagation="true" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" type="checkbox" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_hide_disabled"> Hide disabled</label></li><?php  if (!isset($optinsPanel['disable_product']) || $optinsPanel['disable_product'] == false) : ?><li ng-repeat="product in lhc.userProductNames" data-stopPropagation="true"><label><input type="checkbox" checklist-model="lhc.<?php  echo $optinsPanel['panelid']?>_products" checklist-change="lhc.productChanged('<?php  echo $optinsPanel['panelid']?>_products')" checklist-value="product.id"><i class="material-icons">&#xE8CC;</i>{{product.name}}</label></li><li ng-show="lhc.userProductNames.length > 0" class="border-bottom-grey"></li><?php  endif;?><li ng-repeat="department in lhc.userDepartments" data-stopPropagation="true" ng-hide="( (lhc.<?php  echo $optinsPanel['panelid']?>_only_explicit_online == true && department.oexp == false) || (lhc.<?php  echo $optinsPanel['panelid']?>_hide_hidden == true && department.hidden == true) || (lhc.<?php  echo $optinsPanel['panelid']?>_hide_disabled == true && department.disabled == true) || (lhc.<?php  echo $optinsPanel['panelid']?>_only_online == true && department.ogen == false))"><label><input type="checkbox" checklist-model="lhc.<?php  echo $optinsPanel['panelid']?>" checklist-change="lhc.departmentChanged('<?php  echo $optinsPanel['panelid']?>')" checklist-value="department.id"><i title="Department" class="material-icons">home</i>{{department.name}}</label></li></ul></div></div><div class="col-xs-3"><select class="form-control input-sm" ng-model="lhc.<?php  echo $optinsPanel['limitid']?>" title="Nro de elementos en la lista"><option value="5">5</option><option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select></div></div></div><div class="panel-list" ng-if="pending_chats.list.length > 0"><table class="table table-condensed mb0 table-small table-fixed"><thead><tr><th width="60%"><i title="Visitante" class="material-icons">face</i><a ng-click="lhc.toggleWidget('pending_chats_sort',true)"><i title="Ordenar" class="material-icons">{{lhc.toggleWidgetData['pending_chats_sort'] == false ? 'trending_up' : 'trending_down'}}</i></a></th><th width="20%"><i title="Tiempo de espera" class="material-icons">access_time</i></th><th width="20%"><i title="Departamento" class="material-icons">home</i></th></tr></thead><tr ng-repeat="chat in pending_chats.list track by chat.id" ng-class="{'user-away-row': chat.user_status_front == 2, 'user-online-row': chat.user_status_front == 0}"><td><div data-chat-id="{{chat.id}}" data-toggle="popover" data-placement="top" class="abbr-list" ><a title="Borrar Chat" class="material-icons pull-right" ng-click="lhc.deleteChat(chat.id)">delete</a><span ng-if="chat.country_code != undefined"><img ng-src="/chat/lhc_web/design/defaulttheme/images/flags/{{chat.country_code}}.png" alt="{{chat.country_name}}" title="{{chat.country_name}}" />&nbsp;</span><a title="Abrir en una ventana nueva" class="material-icons" ng-click="lhc.startChatNewWindow(chat.id,chat.nick)">open_in_new</a><a class="material-icons" title="Redirigir usuario al formulario de contacto." ng-click="lhc.redirectContact(chat.id,'¿Está seguro?')">reply</a><a ng-click="lhc.previewChat(chat.id)" class="material-icons">info_outline</a><a ng-click="lhc.startChat(chat.id,chat.nick)" title="{{chat.nick}}"> {{chat.nick}} </a></div><div id="popover-title-{{chat.id}}" class="hide">{{chat.nick}} [{{chat.id}}]</div><div id="popover-content-{{chat.id}}" class="hide"><i class="material-icons">access_time</i>{{chat.time_created_front}}<br/><i class="material-icons">account_box</i>{{chat.plain_user_name ? chat.plain_user_name : '-'}}<br /><i class="material-icons">home</i>{{chat.department_name}}<br /><span ng-show="chat.product_name"><i class="material-icons">&#xE8CC;</i>{{chat.product_name}}</span></div></td><td><div class="abbr-list" title="{{chat.wait_time_pending}}">{{chat.wait_time_pending}}</div></td><td><div class="abbr-list" title="{{chat.department_name}}{{chat.product_name ? ' | '+chat.product_name : ''}}">{{chat.department_name}}{{chat.product_name ? ' | '+chat.product_name : ''}}</div></td></tr></table></div><div ng-if="pending_chats.list.length == 0" class="m10 alert alert-info"><i class="material-icons">search</i>Nada encontrado...</div></div></div><?php  endif; ?><?php  endif;?><?php  elseif ($wiget == 'unread_chats') : ?><?php  if ($unreadTabEnabled == true && $online_chat_enabled_pre == true) : ?><?php  if ($currentUser->hasAccessTo('lhchat','use')) : ?><div class="panel panel-default panel-dashboard" data-panel-id="unread_chats" ng-init="lhc.getToggleWidget('unchats_widget_exp')"><div class="panel-heading"><a href="/chat/lhc_web/index.php/site_admin/chat/list/(hum)/1"><i class="material-icons chat-unread">chat</i> Mensajes no leídos ({{unread_chats.list.length}}{{unread_chats.list.length == lhc.limitu ? '+' : ''}})</a><a title="contraer/expandir" ng-click="lhc.toggleWidget('unchats_widget_exp')" class="fs24 pull-right material-icons exp-cntr">{{lhc.toggleWidgetData['unchats_widget_exp'] == false ? 'expand_less' : 'expand_more'}}</a></div><div ng-if="lhc.toggleWidgetData['unchats_widget_exp'] !== true"><?php  $optinsPanel = array('panelid' => 'unreadd','limitid' => 'limitu'); ?><div class="pl10 pr10 pt10"><div class="row"><div class="col-xs-9"><div class="btn-group btn-block btn-block-department"><button type="button" class="btn btn-default btn-block btn-sm dropdown-toggle btn-department-dropdown" data-toggle="dropdown" aria-expanded="false">{{lhc.<?php  echo $optinsPanel['panelid']?>.length == 0 ? "Todos los departamentos" : lhc.<?php  echo $optinsPanel['panelid']?>Names.join(", ")}} <span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li><label><input type="checkbox" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_all_departments"> Check all</label></li><li><label><input type="checkbox" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_only_online"> Only online</label></li><li><label><input type="checkbox" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_only_explicit_online"> Only explicit online</label></li><li><label><input type="checkbox" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_hide_hidden"> Hide hidden</label></li><li class="border-bottom-grey"><label><input data-stopPropagation="true" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" type="checkbox" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_hide_disabled"> Hide disabled</label></li><?php  if (!isset($optinsPanel['disable_product']) || $optinsPanel['disable_product'] == false) : ?><li ng-repeat="product in lhc.userProductNames" data-stopPropagation="true"><label><input type="checkbox" checklist-model="lhc.<?php  echo $optinsPanel['panelid']?>_products" checklist-change="lhc.productChanged('<?php  echo $optinsPanel['panelid']?>_products')" checklist-value="product.id"><i class="material-icons">&#xE8CC;</i>{{product.name}}</label></li><li ng-show="lhc.userProductNames.length > 0" class="border-bottom-grey"></li><?php  endif;?><li ng-repeat="department in lhc.userDepartments" data-stopPropagation="true" ng-hide="( (lhc.<?php  echo $optinsPanel['panelid']?>_only_explicit_online == true && department.oexp == false) || (lhc.<?php  echo $optinsPanel['panelid']?>_hide_hidden == true && department.hidden == true) || (lhc.<?php  echo $optinsPanel['panelid']?>_hide_disabled == true && department.disabled == true) || (lhc.<?php  echo $optinsPanel['panelid']?>_only_online == true && department.ogen == false))"><label><input type="checkbox" checklist-model="lhc.<?php  echo $optinsPanel['panelid']?>" checklist-change="lhc.departmentChanged('<?php  echo $optinsPanel['panelid']?>')" checklist-value="department.id"><i title="Department" class="material-icons">home</i>{{department.name}}</label></li></ul></div></div><div class="col-xs-3"><select class="form-control input-sm" ng-model="lhc.<?php  echo $optinsPanel['limitid']?>" title="Nro de elementos en la lista"><option value="5">5</option><option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select></div></div></div><div class="panel-list" ng-if="unread_chats.list.length > 0"><table class="table table-condensed mb0 table-small table-fixed"><thead><tr><th width="50%"><i title="Visitante" class="material-icons">face</i></th><th width="30%"><i title="Hace tiempo" class="material-icons">access_time</i></th><th width="20%"><i title="Departamento" class="material-icons">home</i></th></tr></thead><tr ng-repeat="chat in unread_chats.list track by chat.id" ng-class="{'user-away-row': chat.user_status_front == 2, 'user-online-row': chat.user_status_front == 0}"><td><div data-chat-id="{{chat.id}}" data-toggle="popover" data-placement="top" class="abbr-list"><span ng-if="chat.country_code != undefined"><img ng-src="/chat/lhc_web/design/defaulttheme/images/flags/{{chat.country_code}}.png" alt="{{chat.country_name}}" title="{{chat.country_name}}" />&nbsp;</span><a title="Abrir en una ventana nueva" class="material-icons" ng-click="lhc.startChatNewWindow(chat.id,chat.nick)">open_in_new</a><a ng-click="lhc.previewChat(chat.id)" class="material-icons">info_outline</a><a ng-click="lhc.startChat(chat.id,chat.nick)" title="{{chat.nick}}"> {{chat.nick}} </a></div><div id="popover-title-{{chat.id}}" class="hide">{{chat.nick}} [{{chat.id}}]</div><div id="popover-content-{{chat.id}}" class="hide"><i class="material-icons">access_time</i>{{chat.time_created_front}}<br/><i class="material-icons">account_box</i>{{chat.plain_user_name}}<br /><i class="material-icons">home</i>{{chat.department_name}}<br /><span ng-show="chat.product_name"><i class="material-icons">&#xE8CC;</i>{{chat.product_name}}</span></div></td><td><div class="abbr-list" title="{{chat.unread_time.hours}} h. {{chat.unread_time.minits}} m. {{chat.unread_time.seconds}} s. hace.">{{chat.unread_time.hours}} h. {{chat.unread_time.minits}} m. {{chat.unread_time.seconds}} s. hace.</div></td><td><div class="abbr-list" title="{{chat.department_name}}{{chat.product_name ? ' | '+chat.product_name : ''}}">{{chat.department_name}}{{chat.product_name ? ' | '+chat.product_name : ''}}</div></td></tr></table></div><div ng-if="unread_chats.list.length == 0" class="m10 alert alert-info"><i class="material-icons">search</i>Nada encontrado...</div></div></div><?php  endif; ?><?php  endif;?><?php  elseif ($wiget == 'transfered_chats') : ?><?php  $transfer_panel_container_pre_enabled = erLhcoreClassUser::instance()->hasAccessTo('lhchat','use');?><?php  if ($transfer_panel_container_pre_enabled == true) : ?><div class="panel panel-default panel-dashboard" data-panel-id="transfered_chats" ng-init="lhc.getToggleWidget('trchats_widget_exp')"><div class="panel-heading"><i class="material-icons chat-pending">chat</i> Transferred chats({{transfer_dep_chats.list.length}})</a><a title="contraer/expandir" ng-click="lhc.toggleWidget('trchats_widget_exp')" class="fs24 pull-right material-icons exp-cntr">{{lhc.toggleWidgetData['trchats_widget_exp'] == false ? 'expand_less' : 'expand_more'}}</a></div><div ng-if="lhc.toggleWidgetData['trchats_widget_exp'] !== true"><div class="panel-list"><div role="tabpanel" ng-show="transfer_dep_chats.list.length > 0 || transfer_chats.list.length > 0"><!-- Nav tabs -->
<ul class="nav nav-pills p10" role="tablist"><li role="presentation" class="active"><a title="Chats transferidos directamente" href="#transferedperson-widget" aria-controls="transferedperson-widget" role="tab" data-toggle="tab"><i class="material-icons">account_box</i><span class="tru-cnt"></span></a></li><li role="presentation"><a title="Transferido a su departamento" href="#transfereddep-widget" aria-controls="transfereddep-widget" role="tab" data-toggle="tab"><i class="material-icons">account_box</i><span class="trd-cnt"></span></a></li></ul><!-- Tab panes -->
<div class="tab-content mt0"><div role="tabpanel" class="tab-pane active" id="transferedperson-widget"><table class="table table-condensed mb0 table-small table-fixed" ng-if="transfer_chats.list.length > 0"><thead><tr><th width="60%"><i title="Visitante" class="material-icons">face</i></th><th width="40%"><i title="Creado" class="material-icons">access_time</i></th></tr></thead><tr ng-repeat="chat in transfer_chats.list"><td><a title="Abrir en una ventana nueva" class="material-icons" ng-click="lhc.startChatNewWindowTransfer(chat.id,chat.nick,chat.transfer_id)">open_in_new</a><span ng-if="chat.country_code != ''"><img ng-src="/chat/lhc_web/design/defaulttheme/images/flags/{{chat.country_code}}.png" alt="{{chat.country_name}}" title="{{chat.country_name}}" /></span><a ng-click="lhc.previewChat(chat.id)" class="material-icons">info_outline</a><a ng-click="lhc.startChatTransfer(chat.id,chat.nick,chat.transfer_id)" title="Aceptar chat">{{chat.nick}}</a></td><td nowrap="nowrap"><div class="abbr-list">{{chat.time_front}}</div></td></tr></table><div ng-if="transfer_chats.list.length == 0" class="m10 alert alert-info"><i class="material-icons">search</i>Nada encontrado...</div></div><div role="tabpanel" class="tab-pane" id="transfereddep-widget"><table class="table table-condensed mb0 table-small table-fixed" ng-if="transfer_dep_chats.list.length > 0"><thead><tr><th width="60%"><i title="Visitante" class="material-icons">face</i></th><th width="40%"><i title="Transfer time" class="material-icons">access_time</i></th></tr></thead><tr ng-repeat="chat in transfer_dep_chats.list"><td><span ng-if="chat.country_code != ''"><img ng-src="/chat/lhc_web/design/defaulttheme/images/flags/{{chat.country_code}}.png" alt="{{chat.country_name}}" title="{{chat.country_name}}" /></span><a title="Abrir en una ventana nueva" class="material-icons" ng-click="lhc.startChatNewWindowTransfer(chat.id,chat.nick,chat.transfer_id)">open_in_new</a><a ng-click="lhc.previewChat(chat.id)" class="material-icons">chat</a><a ng-click="lhc.startChatTransfer(chat.id,chat.nick,chat.transfer_id)" title="Aceptar chat">{{chat.nick}}</a></td><td nowrap="nowrap"><div class="abbr-list">{{chat.time_front}}</div></td></tr></table><div ng-if="transfer_dep_chats.list.length == 0" class="m10 alert alert-info"><i class="material-icons">search</i>Nada encontrado...</div></div></div></div><div ng-if="transfer_chats.list.length == 0 && transfer_dep_chats.list.length == 0" class="m10 alert alert-info"><i class="material-icons">search</i>Nada encontrado...</div></div></div></div><?php  endif;?><?php  elseif ($wiget == 'closed_chats') : ?><?php  if ($online_chat_enabled_pre == true && $closedTabEnabled == true) : ?><div class="panel panel-default panel-dashboard" data-panel-id="closed_chats" ng-init="lhc.getToggleWidget('closedc_widget_exp')"><div class="panel-heading"><a href="/chat/lhc_web/index.php/site_admin/chat/list/(chat_status)/2"><i class="material-icons chat-closed">chat</i> Chats cerrados ({{closed_chats.list.length}}{{closed_chats.list.length == lhc.limitc ? '+' : ''}})</a><a title="contraer/expandir" ng-click="lhc.toggleWidget('closedc_widget_exp')" class="fs24 pull-right material-icons exp-cntr">{{lhc.toggleWidgetData['closedc_widget_exp'] == false ? 'expand_less' : 'expand_more'}}</a></div><div ng-if="lhc.toggleWidgetData['closedc_widget_exp'] !== true"><?php  $optinsPanel = array('panelid' => 'closedd','limitid' => 'limitc'); ?><div class="pl10 pr10 pt10"><div class="row"><div class="col-xs-9"><div class="btn-group btn-block btn-block-department"><button type="button" class="btn btn-default btn-block btn-sm dropdown-toggle btn-department-dropdown" data-toggle="dropdown" aria-expanded="false">{{lhc.<?php  echo $optinsPanel['panelid']?>.length == 0 ? "Todos los departamentos" : lhc.<?php  echo $optinsPanel['panelid']?>Names.join(", ")}} <span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li><label><input type="checkbox" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_all_departments"> Check all</label></li><li><label><input type="checkbox" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_only_online"> Only online</label></li><li><label><input type="checkbox" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_only_explicit_online"> Only explicit online</label></li><li><label><input type="checkbox" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_hide_hidden"> Hide hidden</label></li><li class="border-bottom-grey"><label><input data-stopPropagation="true" ng-change="lhc.allDepartmentsChanged('<?php  echo $optinsPanel['panelid']?>',true)" type="checkbox" ng-model="lhc.<?php  echo $optinsPanel['panelid']?>_hide_disabled"> Hide disabled</label></li><?php  if (!isset($optinsPanel['disable_product']) || $optinsPanel['disable_product'] == false) : ?><li ng-repeat="product in lhc.userProductNames" data-stopPropagation="true"><label><input type="checkbox" checklist-model="lhc.<?php  echo $optinsPanel['panelid']?>_products" checklist-change="lhc.productChanged('<?php  echo $optinsPanel['panelid']?>_products')" checklist-value="product.id"><i class="material-icons">&#xE8CC;</i>{{product.name}}</label></li><li ng-show="lhc.userProductNames.length > 0" class="border-bottom-grey"></li><?php  endif;?><li ng-repeat="department in lhc.userDepartments" data-stopPropagation="true" ng-hide="( (lhc.<?php  echo $optinsPanel['panelid']?>_only_explicit_online == true && department.oexp == false) || (lhc.<?php  echo $optinsPanel['panelid']?>_hide_hidden == true && department.hidden == true) || (lhc.<?php  echo $optinsPanel['panelid']?>_hide_disabled == true && department.disabled == true) || (lhc.<?php  echo $optinsPanel['panelid']?>_only_online == true && department.ogen == false))"><label><input type="checkbox" checklist-model="lhc.<?php  echo $optinsPanel['panelid']?>" checklist-change="lhc.departmentChanged('<?php  echo $optinsPanel['panelid']?>')" checklist-value="department.id"><i title="Department" class="material-icons">home</i>{{department.name}}</label></li></ul></div></div><div class="col-xs-3"><select class="form-control input-sm" ng-model="lhc.<?php  echo $optinsPanel['limitid']?>" title="Nro de elementos en la lista"><option value="5">5</option><option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select></div></div></div><div class="panel-list" ng-inf="closed_chats.list.length > 0"><table class="table table-condensed mb0 table-small table-fixed"><thead><tr><th width="60%"><i title="Visitante" class="material-icons">face</i></th><th width="20%"><i title="Operador" class="material-icons">account_box</i></th><th width="20%"><i title="Departamento" class="material-icons">home</i></th></tr></thead><tr ng-repeat="chat in closed_chats.list track by chat.id" ng-class="{'user-away-row': chat.user_status_front == 2, 'user-online-row': chat.user_status_front == 0}"><td><div data-toggle="popover" data-chat-id="{{chat.id}}" data-placement="top" class="abbr-list" ><span ng-if="chat.country_code != undefined"><img ng-src="/chat/lhc_web/design/defaulttheme/images/flags/{{chat.country_code}}.png" alt="{{chat.country_name}}" title="{{chat.country_name}}" />&nbsp;</span><a title="Abrir en una ventana nueva" class="material-icons" ng-click="lhc.startChatNewWindow(chat.id,chat.nick)">open_in_new</a><a ng-click="lhc.previewChat(chat.id)" class="material-icons">info_outline</a><a ng-click="lhc.startChat(chat.id,chat.nick)" title="{{chat.nick}}"> {{chat.nick}} </a></div><div id="popover-title-{{chat.id}}" class="hide">{{chat.nick}} [{{chat.id}}]</div><div id="popover-content-{{chat.id}}" class="hide"><i class="material-icons">access_time</i> {{chat.time_created_front}}<br/><i class="material-icons">account_box</i> {{chat.plain_user_name}}<br /><i class="material-icons">home</i> {{chat.department_name}}<br /><span ng-show="chat.product_name"><i class="material-icons">&#xE8CC;</i>{{chat.product_name}}</span></div></td><td><div class="abbr-list" title="{{chat.plain_user_name}}">{{chat.plain_user_name}}</div></td><td><div class="abbr-list" title="{{chat.department_name}}{{chat.product_name ? ' | '+chat.product_name : ''}}">{{chat.department_name}}{{chat.product_name ? ' | '+chat.product_name : ''}}</div></td></tr></table></div><div ng-if="closed_chats.list.length == 0" class="m10 alert alert-info"><i class="material-icons">search</i>Nada encontrado...</div></div></div><?php  endif;?><?php  else : ?><?php   ?><?php  endif;?><?php  endforeach;?></div><?php  endfor;?></div><?php  $popoverInitialized = true; ?></div><?php  elseif (trim($frontTab) == 'online_operators') : ?><?php  if ($canListOnlineUsers == true || $canListOnlineUsersAll == true) : ?><div role="tabpanel" class="tab-pane form-group" id="onlineoperators"><div id="online-operator-list"><?php  $chat_lists_online_operators_enabled = true;?><?php  if ($chat_lists_online_operators_enabled == true) : ?><ul class="list-unstyled"><li ng-repeat="operator in online_op.list track by operator.id" ><a ng-show="operator.user_id != <?php  echo erLhcoreClassUser::instance()->getUserID();?>" href="#" ng-click="lhc.startChatOperator(operator.user_id)" class="small button round">Iniciar chat</a>&nbsp;{{operator.name_support}} | Última actividad: {{operator.lastactivity_ago}} hace.</li></ul><?php  endif;?></div></div><?php  endif; ?><?php  endif; ?><?php  endforeach;?></div></div></div><script>$( document ).ready(function() {lhinst.attachTabNavigator();$('#right-column-page').removeAttr('id');$('#tabs a:first').tab('show')});<?php $chatsOpen = CSCacheAPC::getMem()->getArray('lhc_open_chats'); if (!empty($chatsOpen)){ $chats = erLhcoreClassChat::getList(array('filterin' => array('id' => $chatsOpen))); $deleteKeys = array_diff($chatsOpen, array_keys($chats)); foreach ($deleteKeys as $chat_id) { CSCacheAPC::getMem()->removeFromArray('lhc_open_chats', $chat_id); } foreach ($chats as $chat ){ if (erLhcoreClassChat::hasAccessToRead($chat)){ echo "lhinst.startChat('$chat->id',$('#tabs'),'".erLhcoreClassDesign::shrt($chat->nick,10,'...',30,ENT_QUOTES)."',false);"; } else { CSCacheAPC::getMem()->removeFromArray('lhc_open_chats', $chat->id); } } } ?></script><?php  else : ?><h1>Configuración del sistema</h1><?php  $currentUser = erLhcoreClassUser::instance(); ?><div role="tabpanel"><ul class="nav nav-tabs" role="tablist"><li role="presentation" class="active"><a href="#system" aria-controls="system" role="tab" data-toggle="tab">Sistema</a></li><?php  $system_configuration_tabs_generate_js_enabled = true;?><?php  if ($system_configuration_tabs_generate_js_enabled == true && $currentUser->hasAccessTo('lhsystem','generate_js_tab')) : ?><li role="presentation"><a href="#embed" aria-controls="embed" role="tab" data-toggle="tab">Código de incrustación</a></li><?php  endif; ?><?php  $system_configuration_tabs_chat_enabled = true;?><?php  if ($system_configuration_tabs_chat_enabled == true && $currentUser->hasAccessTo('lhchat','use')) : ?><li role="presentation"><a href="#chatconfiguration" aria-controls="chatconfiguration" role="tab" data-toggle="tab">Configuración de la ayuda en línea</a></li><?php  endif; ?><?php  $system_configuration_tabs_speech_enabled = true;?><?php  if ($system_configuration_tabs_speech_enabled && $currentUser->hasAccessTo('lhspeech','manage')) : ?><li role="presentation"><a href="#speech" aria-controls="speech" role="tab" data-toggle="tab">hablar</a></li><?php  endif;?></ul><div class="tab-content"><div role="tabpanel" class="tab-pane active" id="system"><div class="row"><div class="col-md-6"><h4>Sistema</h4><ul><?php  if ($currentUser->hasAccessTo('lhsystem','timezone')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/system/timezone">Configuraciones de zona horaria</a></li><?php  endif; ?><?php  if ($currentUser->hasAccessTo('lhsystem','performupdate')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/system/update">Información sobre Actualización</a></li><?php  endif; ?><?php  $system_configuration_links_configuresmtp_enabled = true;?><?php  if ($system_configuration_links_configuresmtp_enabled == true && $currentUser->hasAccessTo('lhsystem','configuresmtp')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/system/smtp">Configuración del correo electrónico</a></li><?php  endif; ?><?php  if ($currentUser->hasAccessTo('lhabstract','use')) : ?><?php  if ($currentUser->hasAccessTo('lhsystem','changetemplates')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/abstract/list/EmailTemplate">Plantillas de e-mail</a></li><?php  endif; ?><?php  endif;?><?php  if ($currentUser->hasAccessTo('lhsystem','configurelanguages') || $currentUser->hasAccessTo('lhsystem','changelanguage')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/system/languages">Configuración de Idiomas</a></li><?php  endif; ?><?php  if ($currentUser->hasAccessTo('lhsystem','expirecache')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/system/expirecache">Clean cache</a></li><?php  endif; ?></ul></div><?php  $system_configuration_links_users_section_enabled = true;?><?php  if ($system_configuration_links_users_section_enabled == true) : ?><div class="col-md-6"><?php  if ($currentUser->hasAccessTo('lhuser','userlist') || $currentUser->hasAccessTo('lhuser','grouplist') || $currentUser->hasAccessTo('lhpermission','list')) : ?><h4>Usuarios</h4><ul class="circle small-list"><?php  if ($currentUser->hasAccessTo('lhuser','userlist')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/user/userlist">Usuarios</a></li><?php  endif; ?><?php  if ($currentUser->hasAccessTo('lhuser','userautologin')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/user/autologinconfig">Configuración auto login</a></li><?php  endif; ?><?php  if ($currentUser->hasAccessTo('lhuser','grouplist')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/user/grouplist">Lista de los grupos</a></li><?php  endif; ?><?php  if ($currentUser->hasAccessTo('lhpermission','list')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/permission/roles">Lista de roles</a></li><?php  endif; ?></ul><?php  endif; ?></div><?php  endif;?></div></div><?php  $system_configuration_tabs_content_chat_enabled = true;?><?php  if ($system_configuration_tabs_content_chat_enabled == true && $currentUser->hasAccessTo('lhchat','use')) : ?><div role="tabpanel" class="tab-pane" id="chatconfiguration"><div class="row"><div class="col-md-6"><ul><?php  if ($currentUser->hasAccessTo('lhdepartment','list')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/department/departments">Departamentos</a></li><?php  endif; ?><?php  $system_configuration_links_blockusers_enabled = true;?><?php  if ($system_configuration_links_blockusers_enabled == true && $currentUser->hasAccessTo('lhchat','allowblockusers')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/chat/blockedusers">Usuarios bloqueados</a></li><?php  endif; ?><li><a href="/chat/lhc_web/index.php/site_admin/chat/listchatconfig">Configuración de chat</a></li><?php  if ($currentUser->hasAccessTo('lhchat','administrategeoconfig')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/chat/geoconfiguration">Configuración de detección de GEO</a></li><?php  endif; ?><?php  $system_configuration_links_geoadjustment_enabled = true;?><?php  if ($system_configuration_links_geoadjustment_enabled == true && $currentUser->hasAccessTo('lhchat','geoadjustment')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/chat/geoadjustment">Ajuste Geo</a></li><?php  endif; ?><?php  if ($currentUser->hasAccessTo('lhchat','administrateconfig')) : ?><?php  $system_configuration_links_sync_and_sounde_settings_enabled = true;?><?php  if ($system_configuration_links_sync_and_sounde_settings_enabled == true) : ?><li><a href="/chat/lhc_web/index.php/site_admin/chat/syncandsoundesetting">Ajustes de sincronización y sonido</a></li><?php  endif;?><li><a href="/chat/lhc_web/index.php/site_admin/chat/startchatformsettings">Ajustes del formulario de Iniciar chat</a></li><?php  endif;?><?php  $system_configuration_links_translation_enabled = true;?><?php  if ($system_configuration_links_translation_enabled == true && $currentUser->hasAccessTo('lhtranslation','configuration')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/translation/configuration">Traducción automática</a></li><?php  endif;?><?php  $system_configuration_links_cannedmsg_enabled = true;?><?php  if ($system_configuration_links_cannedmsg_enabled == true && $currentUser->hasAccessTo('lhchat','administratecannedmsg')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/chat/cannedmsg">Mensajes predefinidos</a></li><?php  endif; ?><?php  $system_configuration_links_survey_enabled = true;?><?php  if ($system_configuration_links_survey_enabled == true && $currentUser->hasAccessTo('lhsurvey','manage_survey')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/abstract/list/Survey">Encuestas</a></li><?php  endif; ?><?php  if ($currentUser->hasAccessTo('lhabstract','use')) : ?><?php  $system_configuration_proactive_enabled = true;?><?php  if ($system_configuration_proactive_enabled == true && $currentUser->hasAccessTo('lhchat','administrateinvitations')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/abstract/list/ProactiveChatInvitation">Invitaciones de chat pro activas</a></li><?php  endif;?><?php  $system_configuration_links_autoresponder_enabled = true;?><?php  if ($system_configuration_links_autoresponder_enabled == true && $currentUser->hasAccessTo('lhchat','administrateresponder')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/abstract/list/AutoResponder">Auto responder</a></li><?php  endif;?><?php  endif; ?><?php  $system_configuration_links_xmpp_enabled = true;?><?php  if ($system_configuration_links_xmpp_enabled == true && $currentUser->hasAccessTo('lhxmp','configurexmp')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/xmp/configuration">Configuración XMPP</a></li><?php  endif; ?><li><a href="/chat/lhc_web/index.php/site_admin/chat/list">Lista de chats</a></li><?php  if ($currentUser->hasAccessTo('lhchatarchive','archive')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/chatarchive/archive">Archivo de chats</a></li><?php  endif; ?><?php  $system_configuration_links_statistic_enabled = true;?><?php  if ($system_configuration_links_statistic_enabled == true && $currentUser->hasAccessTo('lhstatistic','viewstatistic')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/statistic/statistic">Estadística</a></li><?php  endif; ?><?php  if ($currentUser->hasAccessTo('lhchat','maintenance')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/chat/maintenance">Mantenimiento</a></li><?php  endif; ?><?php  $system_configuration_links_product_enabled = true;?><?php  if ($system_configuration_links_product_enabled == true && $currentUser->hasAccessTo('lhproduct','manage_product')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/product/index">Producto</a></li><?php  endif; ?><?php  $system_configuration_paid_chat_enabled = true; ?><?php  if ($system_configuration_paid_chat_enabled == true && $currentUser->hasAccessTo('lhpaidchat','use_admin')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/paidchat/settings">Paid chat configuration</a></li><?php  endif; ?><?php  $system_configuration_rest_api_enabled = true; ?><?php  if ($system_configuration_rest_api_enabled == true && $currentUser->hasAccessTo('lhrestapi','use_admin')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/restapi/index">Rest API</a></li><?php  endif; ?></ul></div><div class="col-md-6"><?php  $system_configuration_links_files_enabled = true;?><?php  if ($system_configuration_links_files_enabled == true && ($currentUser->hasAccessTo('lhfile','use') || $currentUser->hasAccessTo('lhfile','file_list'))) : ?><h5>Archivos</h5><ul><?php  if ($currentUser->hasAccessTo('lhfile','use')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/file/configuration">Configuración de subida de archivos</a></li><?php  endif; ?><?php  if ($currentUser->hasAccessTo('lhfile','file_list')) : ?><li><a href="/chat/lhc_web/index.php/site_admin/file/list">Lista de archivos</a></li><?php  endif; ?></ul><?php  endif; ?><?php  if ($currentUser->hasAccessTo('lhabstract','use') && $currentUser->hasAccessTo('lhtheme','administratethemes')) : ?><h5>Aplicando tema</h5><ul><li><a href="/chat/lhc_web/index.php/site_admin/abstract/list/WidgetTheme">Tema del widget</a></li><li><a href="/chat/lhc_web/index.php/site_admin/theme/import">Importar temas nuevos</a></li><li><a href="/chat/lhc_web/index.php/site_admin/theme/default">Tema predefinido</a></li></ul><h5>Back office theming</h5><ul><li><a href="/chat/lhc_web/index.php/site_admin/theme/adminthemes">Admin themes</a></li><li><a href="/chat/lhc_web/index.php/site_admin/theme/defaultadmintheme">Default admin theme</a></li></ul><?php  endif; ?></div></div></div><?php  endif;?><?php  $system_configuration_tabs_content_chat_embed_js_enabled = true; ?><?php  if ($system_configuration_tabs_content_chat_embed_js_enabled == true && $currentUser->hasAccessTo('lhsystem','generate_js_tab')) : ?><div role="tabpanel" class="tab-pane" id="embed"><div class="row"><?php  $system_configuration_links_chat_embed_enabled = true;?><?php  if ($system_configuration_links_chat_embed_enabled == true && $currentUser->hasAccessTo('lhsystem','generatejs')) : ?><div class="col-md-6"><h4>Código de incrustación para Live help</h4><ul><li><a href="/chat/lhc_web/index.php/site_admin/system/htmlcode">Código de incrustación del Widget</a></li><li><a href="/chat/lhc_web/index.php/site_admin/system/embedcode">Código de incrustación para la página</a></li></ul></div><?php  endif; ?><?php  $system_configuration_links_faq_embed_enabled = true;?><?php  if ($system_configuration_links_faq_embed_enabled == true && $currentUser->hasAccessTo('lhfaq','manage_faq')) : ?><div class="col-md-6"><h4>Código de incrustación para FAQ</h4><ul><li><a href="/chat/lhc_web/index.php/site_admin/faq/htmlcode">Código de incrustación del Widget</a></li><li><a href="/chat/lhc_web/index.php/site_admin/faq/embedcode">Código de incrustación para la página</a></li></ul></div><?php  endif; ?><?php  $system_configuration_links_questionary_embed_enabled = true;?><?php  if ($system_configuration_links_questionary_embed_enabled == true && $currentUser->hasAccessTo('lhquestionary','manage_questionary')) : ?><div class="col-md-6"><h4>Código de incrustación para cuestionario</h4><ul><li><a href="/chat/lhc_web/index.php/site_admin/questionary/htmlcode">Código de incrustación del Widget</a></li><li><a href="/chat/lhc_web/index.php/site_admin/questionary/embedcode">Código de incrustación para la página</a></li></ul></div><?php  endif; ?><?php  $system_configuration_links_chatbox_embed_enabled = true;?><?php  if ($system_configuration_links_chatbox_embed_enabled == true && $currentUser->hasAccessTo('lhchatbox','manage_chatbox')) : ?><div class="col-md-6"><h4>Código de incrustación para Chatbox</h4><ul><li><a href="/chat/lhc_web/index.php/site_admin/chatbox/htmlcode">Código de incrustación del Widget</a></li><li><a href="/chat/lhc_web/index.php/site_admin/chatbox/embedcode">Código de incrustación para la página</a></li></ul></div><?php  endif; ?><?php  $system_configuration_links_browse_offers_embed_enabled = true;?><?php  if ($system_configuration_links_browse_offers_embed_enabled == true && $currentUser->hasAccessTo('lhbrowseoffer','manage_bo')) : ?><div class="col-md-6"><h4>Código de incrustación  para ofertas en el navegador</h4><ul><li><a href="/chat/lhc_web/index.php/site_admin/browseoffer/htmlcode">Código de incrustación</a></li></ul></div><?php  endif; ?><?php   ?></div></div><?php  endif; ?><?php  $system_configuration_tabs_content_speech_enabled = true;?><?php  if ($system_configuration_tabs_content_speech_enabled == true && $currentUser->hasAccessTo('lhspeech','manage')) : ?><div role="tabpanel" class="tab-pane" id="speech"><ul class="circle small-list"><li><a title="Configurar el idioma predeterminado del dictado" href="/chat/lhc_web/index.php/site_admin/speech/defaultlanguage">Idioma del dictado</a></li></ul></div><?php  endif;?></div></div><?php  endif;?>