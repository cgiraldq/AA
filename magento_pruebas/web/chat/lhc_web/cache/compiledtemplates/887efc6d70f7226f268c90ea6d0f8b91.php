<?php  if ($disabled_department === true) : ?><h1>El departamento esta deshabilitado</h1><?php  else : ?><?php  if (!isset($start_data_fields['show_operator_profile']) || $start_data_fields['show_operator_profile'] == false) : ?><div class="pl10 max-width-180 pull-right absolute-language-top-right"><?php  $rightLanguage = true;?><?php  if ((int)'0' == 1) : ?><?php   $enabledLanguages = explode(',','eng,lit,hrv,esp,por,nld,ara,ger,pol,rus,ita,fre,chn,cse,nor,tur,vnm,idn,sve,per,ell,dnk,rou,bgr,tha,geo,fin,alb'); $langArray = array( 'eng' => 'English', 'lit' => 'Lietuviškai', 'hrv' => 'Croatian', 'esp' => 'Spanish', 'por' => 'Portuguese', 'nld' => 'Dutch', 'ara' => 'Arabic', 'ger' => 'German', 'pol' => 'Polish', 'rus' => 'Russian', 'ita' => 'Italian', 'fre' => 'Français', 'chn' => 'Chinese', 'cse' => 'Czech', 'nor' => 'Norwegian', 'tur' => 'Turkish', 'vnm' => 'Vietnamese', 'idn' => 'Indonesian', 'sve' => 'Swedish', 'per' => 'Persian', 'ell' => 'Greek', 'dnk' => 'Danish', 'rou' => 'Romanian', 'bgr' => 'Bulgarian', 'tha' => 'Thai', 'geo' => 'Georgian', 'fin' => 'Finnish', 'alb' => 'Albanian', ); ?><div class="btn-group pull-right" role="group"><button type="button" class="btn btn-default btn-xs dropdown-toggle" title="Seleccione su lenguaje." data-toggle="dropdown" aria-expanded="false"><i class="material-icons mr-0">language</i><span class="caret"></span></button><ul class="dropdown-menu f-dropdown-lang" role="menu"><?php  foreach ($enabledLanguages as $siteAccess) : ?><li><a onclick="return lhinst.switchLang($('#form-start-chat'),'<?php  echo $siteAccess?>')" href="#"><?php  echo $langArray[$siteAccess]?></a><?php  endforeach;?></ul></div><?php  endif;?></div><?php  endif;?><?php $exitTemplate = false; $statusGeoAdjustment = erLhcoreClassChat::getAdjustment(array (0 => false,'use_geo_adjustment' => false,'available_for' => '','other_countries' => 'custom','hide_for' => '','other_status' => 'offline','rest_status' => 'hidden','apply_widget' => 0,), $input_data->vid); if ($statusGeoAdjustment['status'] == 'offline') { $forceoffline = true; $leaveamessage = true; } elseif ($statusGeoAdjustment['status'] == 'hidden') { $errors = array('El soporte en línea no está disponible en su país'); ?><?php  if (isset($errors)) : ?><div data-alert class="alert alert-danger alert-dismissible fade in"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><ul class="validation-ul"><?php  foreach ($errors as $err) : ?><li><?php  echo $err?></li><?php  endforeach;?></ul></div><?php  endif;?><?php  $exitTemplate = true; } ?><?php  if ($exitTemplate == true) return; ?><?php  if ($leaveamessage == false || ($forceoffline === false && erLhcoreClassChat::isOnline($department, false, array('ignore_user_status'=> (int)'0', 'online_timeout' => (int)'300')) === true)) : ?><?php  if (isset($start_data_fields['show_operator_profile']) && $start_data_fields['show_operator_profile'] == true) : ?><div class="operator-info float-break<?php  if (!isset($start_data_fields['remove_operator_space']) || $start_data_fields['remove_operator_space'] == false) : ?> mb10 round-profile<?php  else : ?><?php  endif;?>"><div class="pull-left pr5"><?php  if ($theme !== false && $theme->operator_image_url != '') : ?><img src="<?php  echo $theme->operator_image_url?>" alt="" /><?php  else : ?><i class="icon-assistant material-icons">account_box</i><?php  endif;?></div><div class="pl10"><?php  $rightLanguage = true;?><?php  if ((int)'0' == 1) : ?><?php   $enabledLanguages = explode(',','eng,lit,hrv,esp,por,nld,ara,ger,pol,rus,ita,fre,chn,cse,nor,tur,vnm,idn,sve,per,ell,dnk,rou,bgr,tha,geo,fin,alb'); $langArray = array( 'eng' => 'English', 'lit' => 'Lietuviškai', 'hrv' => 'Croatian', 'esp' => 'Spanish', 'por' => 'Portuguese', 'nld' => 'Dutch', 'ara' => 'Arabic', 'ger' => 'German', 'pol' => 'Polish', 'rus' => 'Russian', 'ita' => 'Italian', 'fre' => 'Français', 'chn' => 'Chinese', 'cse' => 'Czech', 'nor' => 'Norwegian', 'tur' => 'Turkish', 'vnm' => 'Vietnamese', 'idn' => 'Indonesian', 'sve' => 'Swedish', 'per' => 'Persian', 'ell' => 'Greek', 'dnk' => 'Danish', 'rou' => 'Romanian', 'bgr' => 'Bulgarian', 'tha' => 'Thai', 'geo' => 'Georgian', 'fin' => 'Finnish', 'alb' => 'Albanian', ); ?><div class="btn-group pull-right" role="group"><button type="button" class="btn btn-default btn-xs dropdown-toggle" title="Seleccione su lenguaje." data-toggle="dropdown" aria-expanded="false"><i class="material-icons mr-0">language</i><span class="caret"></span></button><ul class="dropdown-menu f-dropdown-lang" role="menu"><?php  foreach ($enabledLanguages as $siteAccess) : ?><li><a onclick="return lhinst.switchLang($('#form-start-chat'),'<?php  echo $siteAccess?>')" href="#"><?php  echo $langArray[$siteAccess]?></a><?php  endforeach;?></ul></div><?php  endif;?><span><i><?php  if ($theme !== false && $theme->intro_operator_text != '') : ?><?php  echo htmlspecialchars($theme->intro_operator_text); ?><?php  else : ?>¿Tiene alguna duda? Escribanos<?php  endif;?></i></span><?php   ?></div></div><?php  endif;?><?php  if (isset($errors)) : ?><?php  if (isset($errors)) : ?><div data-alert class="alert alert-danger alert-dismissible fade in"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><ul class="validation-ul"><?php  foreach ($errors as $err) : ?><li><?php  echo $err?></li><?php  endforeach;?></ul></div><?php  endif;?><?php  endif; ?><?php   $hasExtraField = false; if ($theme !== false && $theme->explain_text != '') : ?><p class="start-chat-intro"><?php  echo erLhcoreClassBBCode::make_clickable(htmlspecialchars($theme->explain_text))?></p><?php  endif;?><form method="post" id="form-start-chat" action="/chat/lhc_web/index.php/esp/chat/chatwidget<?php  echo $append_mode?><?php  $department !== false ? print '/(department)/'.$department : ''?><?php  $input_data->priority !== false ? print '/(priority)/'.$input_data->priority : ''?><?php  $input_data->vid !== false ? print '/(vid)/'.htmlspecialchars($input_data->vid) : ''?><?php  $input_data->hash_resume !== false ? print '/(hash_resume)/'.htmlspecialchars($input_data->hash_resume) : ''?><?php  $leaveamessage == true ? print '/(leaveamessage)/true' : ''?><?php  $forceoffline == true ? print '/(offline)/true' : ''?><?php  echo $append_mode_theme?>" onsubmit="return <?php  if (isset($start_data_fields['message_auto_start']) && $start_data_fields['message_auto_start'] == true) : ?>lhinst.prestartChat('<?php  echo time()?>',$(this))<?php  else : ?>lhinst.addCaptcha('<?php  echo time()?>',$(this))<?php  endif?>"><?php  if (isset($start_data_fields['message_visible_in_page_widget']) && $start_data_fields['message_visible_in_page_widget'] == true && isset($start_data_fields['show_messages_box']) && $start_data_fields['show_messages_box'] == true) : ?><div id="messages" class="mb10"><div class="msgBlock" <?php  if ('' > 0) : ?>style="height:<?php  echo (int)''?>px"<?php  endif?> id="messagesBlock"><?php  $formIdentifier = '#form-start-chat';?><script>var visitorTitle =  <?php  echo json_encode(htmlspecialchars_decode('Yo',ENT_QUOTES))?>;$( "<?php  echo $formIdentifier?>" ).submit(function() {if ($('#messagesBlock > .message-row.response').size() == 0 && $(this).attr('key-up-started') != 1) {jQuery('<div/>', {'class': 'message-row response',text: $('#id_Question').val()}).appendTo('#messagesBlock').prepend('<span class="usr-tit vis-tit">'+<?php  echo json_encode(htmlspecialchars_decode('Yo',ENT_QUOTES))?>+'</span>');$('#messagesBlock').animate({ scrollTop: $('#messagesBlock').prop('scrollHeight') }, 1000);}});</script><?php  if (isset($show_demo) && $show_demo == true) : ?><div><div class="message-row response" id="msg-10459" data-op-id="0"><div class="msg-date">10:14:39</div><span class="usr-tit vis-tit" role="button"><i class="material-icons chat-operators mi-fs15 mr-0">face</i>Visitor</span> Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</div><div class="message-row message-admin operator-changes" id="msg-10463" data-op-id="1"><div class="msg-date">10:18:22</div><span class="usr-tit op-tit"><i class="material-icons chat-operators mi-fs15 mr-0">account_box</i>Operator</span>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</div></div><?php  endif;?></div></div><?php  endif;?><?php  $formResubmitId = 'form-start-chat'; ?><?php   if (isset($errors['captcha']) && !isset($_POST['ResubmitCaptcha'])) : ?><input type="hidden" name="ResubmitCaptcha" value="true" /><script>$( document ).ready(function() {<?php  if (!(isset($start_data_fields['message_auto_start']) && $start_data_fields['message_auto_start'] == true)) : ?>$('#<?php  echo $formResubmitId?>').submit();<?php  endif;?>});</script><?php  endif;?><div class="row"><?php  if (isset($start_data_fields['name_visible_in_page_widget']) && $start_data_fields['name_visible_in_page_widget'] == true) : $hasExtraField = true;?><?php  if (isset($start_data_fields['name_hidden']) && $start_data_fields['name_hidden'] == true) : ?><input type="hidden" name="Username" value="<?php  echo htmlspecialchars($input_data->username);?>" /><?php  else : ?><?php  if (in_array('username', $input_data->hattr)) : ?><input type="hidden" name="Username" value="<?php  echo htmlspecialchars($input_data->username);?>" /><?php  else : ?><div class="col-xs-6 form-group<?php  if (isset($errors['nick'])) : ?> has-error<?php  endif;?>"><label class="control-label">Nombre<?php  if (isset($start_data_fields['name_require_option']) && $start_data_fields['name_require_option'] == 'required') : ?>*<?php  endif;?></label><input type="text" class="form-control" name="Username" value="<?php  echo htmlspecialchars($input_data->username);?>" /></div><?php  endif; ?><?php  endif; ?><?php  endif; ?><?php  if (isset($start_data_fields['email_visible_in_page_widget']) && $start_data_fields['email_visible_in_page_widget'] == true) : $hasExtraField = true;?><?php  if (isset($start_data_fields['email_hidden']) && $start_data_fields['email_hidden'] == true) : ?><input type="hidden" name="Email" value="<?php  echo htmlspecialchars($input_data->email);?>" /><?php  else : ?><?php  if (in_array('email', $input_data->hattr)) : ?><input type="hidden" name="Email" value="<?php  echo htmlspecialchars($input_data->email);?>" /><?php  else : ?><div class="col-xs-6 form-group<?php  if (isset($errors['email'])) : ?> has-error<?php  endif;?>"><label class="control-label">E-mail<?php  if (isset($start_data_fields['email_require_option']) && $start_data_fields['email_require_option'] == 'required') : ?>*<?php  endif;?></label><input class="form-control" type="text" name="Email" value="<?php  echo htmlspecialchars($input_data->email);?>" /></div><?php  endif; ?><?php  endif; ?><?php  endif; ?></div><?php  if (isset($start_data_fields['phone_visible_in_page_widget']) && $start_data_fields['phone_visible_in_page_widget'] == true) : $hasExtraField = true;?><?php  if (isset($start_data_fields['phone_hidden']) && $start_data_fields['phone_hidden'] == true) : ?><input type="hidden" name="Phone" value="<?php  echo htmlspecialchars($input_data->phone);?>" /><?php  else : ?><?php  if (in_array('phone', $input_data->hattr)) : ?><input type="hidden" name="Phone" value="<?php  echo htmlspecialchars($input_data->phone);?>" /><?php  else : ?><div class="form-group<?php  if (isset($errors['phone'])) : ?> has-error<?php  endif;?>"><label class="control-label">Teléfono<?php  if (isset($start_data_fields['phone_require_option']) && $start_data_fields['phone_require_option'] == 'required') : ?>*<?php  endif;?></label><input class="form-control" type="text" name="Phone" value="<?php  echo htmlspecialchars($input_data->phone);?>" /></div><?php  endif; ?><?php  endif; ?><?php  endif; ?><?php  $canReopen = '1' == 1 && ($reopenData = erLhcoreClassChat::canReopenDirectly(array('reopen_closed' => '1'))) !== false; ?><?php  $adminCustomFieldsMode = 'on';?><?php   if (isset($start_data_fields['custom_fields']) && $start_data_fields['custom_fields'] != '') : $customAdminfields = json_decode($start_data_fields['custom_fields'],true); if (is_array($customAdminfields)) : ?><div class="row"><?php  foreach ($customAdminfields as $key => $adminField) : if ($adminField['visibility'] == 'all' || $adminCustomFieldsMode == $adminField['visibility']) : ?><?php  if ($adminField['fieldtype'] == 'hidden' || (isset($input_data->via_hidden[$key]) && $input_data->via_hidden[$key] == 't')) : ?><?php  if (isset($input_data->via_hidden[$key]) && $input_data->via_hidden[$key] == 't') : ?><input class="form-control" type="hidden" name="via_hidden[<?php  echo $key?>]" value="t" /><?php  endif;?><?php  if (isset($input_data->via_encrypted[$key]) && $input_data->via_encrypted[$key] == 't') : ?><input class="form-control" type="hidden" name="via_encrypted[<?php  echo $key?>]" value="t" /><?php  endif;?><input class="form-control" type="hidden" name="value_items_admin[<?php  echo $key?>]" value="<?php  isset($input_data->value_items_admin[$key]) ? print htmlspecialchars($input_data->value_items_admin[$key]) : print htmlspecialchars($adminField['defaultvalue'])?>" /><?php  else : $hasExtraField = true; ?><div class="col-xs-<?php  echo htmlspecialchars($adminField['size'])?>"><div class="form-group<?php  if (isset($errors['additional_admin_'.$key])) : ?> has-error<?php  endif;?>"><label class="control-label"><?php  echo htmlspecialchars($adminField['fieldname'])?>&nbsp;<?php  $adminField['isrequired'] == 'true' ? print '*' : ''?></label><input class="form-control" type="text" name="value_items_admin[<?php  echo $key?>]" value="<?php  isset($input_data->value_items_admin[$key]) ? print htmlspecialchars($input_data->value_items_admin[$key]) : print htmlspecialchars($adminField['defaultvalue'])?>" /></div></div><?php  endif; endif; endforeach;?></div><?php  endif; endif;?><?php  if (isset($start_data_fields['message_visible_in_page_widget']) && $start_data_fields['message_visible_in_page_widget'] == true) : ?><?php  if (isset($start_data_fields['message_hidden']) && $start_data_fields['message_hidden'] == true) : $hasExtraField = true; ?><textarea class="hide" placeholder="Ingrese su mensaje" name="Question"><?php  echo htmlspecialchars($input_data->question);?></textarea><?php  else : ?><div class="<?php  if (isset($errors['question'])) : ?> has-error<?php  endif;?>"><?php  if (!isset($start_data_fields['hide_message_label']) || $start_data_fields['hide_message_label'] == false) : ?><label class="control-label">Su pregunta<?php  if (isset($start_data_fields['message_require_option']) && $start_data_fields['message_require_option'] == 'required') : ?>*<?php  endif;?></label><?php  endif;?><?php   ?><textarea class="form-control form-group <?php  if ($hasExtraField !== true && $canReopen !== true) : ?>btrad-reset<?php  endif;?>" <?php  if (isset($start_data_fields['user_msg_height']) && $start_data_fields['user_msg_height'] > 0) : ?>style="height: <?php  echo $start_data_fields['user_msg_height']?>px"<?php  endif;?> placeholder="Por favor ingrese su mensaje..." id="id_Question" name="Question"><?php  echo htmlspecialchars($input_data->question);?></textarea><?php   ?></div><?php  endif; ?><?php  else : $hasExtraField = true; endif; ?><?php   $modeUserVariables = isset($modeUserVariables) ? $modeUserVariables : 'on'; if (!empty($input_data->name_items)) { $hasExtraField = true; }; foreach ($input_data->name_items as $item) : ?><input type="hidden" name="name_items[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;?><?php  if (isset($input_data->value_sizes)) : foreach ($input_data->value_sizes as $item) : ?><input type="hidden" name="value_sizes[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;endif;?><?php  if (isset($input_data->values_req)) : foreach ($input_data->values_req as $item) : ?><input type="hidden" name="values_req[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;endif;?><?php  if (isset($input_data->value_show)) : foreach ($input_data->value_show as $item) : ?><input type="hidden" name="value_show[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;endif;?><?php  if (isset($input_data->hattr)) : foreach ($input_data->hattr as $item) : ?><input type="hidden" name="hattr[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;endif;?><?php  if (isset($input_data->encattr)) : foreach ($input_data->encattr as $item) : ?><input type="hidden" name="encattr[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;endif;?><?php $hasVisibleField = false; foreach ($input_data->value_types as $key => $item) : $showField = ($input_data->value_show[$key] == $modeUserVariables || $input_data->value_show[$key] == 'b'); ($hasVisibleField = ($item == 'text' && $showField == true) ? true : $hasVisibleField); ?><input type="hidden" name="value_types[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;?><?php  if ($hasVisibleField == true) : ?><div class="row"><?php  endif;?><?php  foreach ($input_data->value_items as $key => $item) : $showField = ($input_data->value_show[$key] == $modeUserVariables || $input_data->value_show[$key] == 'b'); $visibleItem = (isset($input_data->value_types[$key]) && $input_data->value_types[$key] == 'text' && isset($input_data->name_items[$key])); ?><?php  if ($visibleItem == true && $showField == true) : ?><div class="form-group col-xs-<?php  isset($input_data->value_sizes[$key]) ? print (int)$input_data->value_sizes[$key] : print 6?><?php  if (isset($errors['additional_'.$key])) : ?> has-error<?php  endif;?>"><label class="control-label"><?php  echo htmlspecialchars($input_data->name_items[$key])?><?php  isset($input_data->values_req[$key]) && $input_data->values_req[$key] == 't' ? print '*' : ''?></label><?php  endif;?><input class="form-control" type="<?php  isset($input_data->value_types[$key]) && $showField == true ? print htmlspecialchars($input_data->value_types[$key]) : print 'hidden' ?>" name="value_items[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  if ($visibleItem == true && $showField == true) : ?></div><?php  endif;?><?php  endforeach;?><?php  if ($hasVisibleField == true) : ?></div><?php  endif;?><?php if ('0' == 1) : $filter = array('sort' => 'priority ASC, name ASC'); if (isset($input_data->product_id_array) && !empty($input_data->product_id_array)) { $filter['filterin']['id'] = $input_data->product_id_array; } if (isset($input_data->departament_id_array) && !empty($input_data->departament_id_array)) { $filter['filterin']['departament_id'] = $input_data->departament_id_array; } if ($input_data->departament_id > 0) { $filter['filterin']['departament_id'][] = $input_data->departament_id; } $filter['filter']['disabled'] = 0; $products = erLhAbstractModelProduct::getList($filter); if (!empty($products)) : $departmentsOptions['hide_department'] = true; ?><input type="hidden" name="HasProductID" value="on" /><?php  if (isset($input_data->product_id_array)) : foreach ($input_data->product_id_array as $definedProduct) : ?><input type="hidden" name="ProductIDDefined[]" value="<?php  echo $definedProduct?>" /><?php  endforeach; endif; ?><div class="form-group<?php  if (isset($errors['ProductID'])) : ?> has-error<?php  endif;?>"><label class="control-label">Producto*</label><select class="form-control" name="ProductID"><option value="">Choose a product</option><?php  foreach ($products as $product) : ?><option value="<?php  echo $product->id?>" <?php  if ($input_data->product_id == $product->id) : ?>selected="selected"<?php  endif;?> ><?php  echo htmlspecialchars($product->name)?></option><?php  endforeach;?></select></div><?php  endif; endif; ?><?php  if ($department === false) : ?><?php   $filter = array('filter' => array('disabled' => 0, 'hidden' => 0)); if (isset($input_data->departament_id_array)) { $filter['filterin']['id'] = $input_data->departament_id_array; } $filter['sort'] = 'sort_priority ASC, name ASC'; $departments = erLhcoreClassModelDepartament::getList($filter); if (count($departments) > 1) : $hasExtraField = true;?><?php  if (isset($input_data->departament_id_array)) : foreach ($input_data->departament_id_array as $definedDep) : ?><input type="hidden" name="DepartmentIDDefined[]" value="<?php  echo $definedDep?>" /><?php  endforeach; endif; ?><?php  if (!isset($departmentsOptions['hide_department']) || $departmentsOptions['hide_department'] == false) : ?><div class="form-group<?php  if (isset($errors['department'])) : ?> has-error<?php  endif;?>"><label class="control-label"><?php  if (isset($theme) && $theme !== false && $theme->department_title != '') : ?><?php  echo htmlspecialchars($theme->department_title)?><?php  else : ?>Departamento<?php  endif;?></label><select class="form-control" name="DepartamentID" id="id_DepartamentID"><?php  if (isset($theme) && $theme !== false && $theme->department_select != '') : ?><option value="-1"><?php  echo htmlspecialchars($theme->department_select)?></option><?php  endif;?><?php  $departments = erLhcoreClassDepartament::sortByStatus($departments); foreach ($departments as $departament) : $isOnline = erLhcoreClassChat::isOnline($departament->id,false,array('ignore_user_status'=> (int)'0', 'online_timeout' => (int)'300')); ?><?php  if (($departament->visible_if_online == 1 && $isOnline === true) || $departament->visible_if_online == 0) : ?><option data-attr-online="<?php  if ($isOnline === false) : ?>false<?php  else : ?>true<?php  endif;?>" <?php  if ($isOnline === false) : ?>class="offline-dep"<?php  endif;?> value="<?php  echo $departament->id?>" <?php  isset($input_data->departament_id) && $input_data->departament_id == $departament->id ? print 'selected="selected"' : '';?> ><?php  echo htmlspecialchars($departament->name)?><?php  if ($isOnline === false) : ?>&nbsp;&nbsp;--=Desconectado=--<?php  endif;?></option><?php  endif;?><?php  endforeach; ?></select></div><?php  endif; endif; ?><?php  endif;?><input type="hidden" name="user_timezone" value="" /><script>$(document).ready(function() {Date.prototype.stdTimezoneOffset = function() {var jan = new Date(this.getFullYear(), 0, 1);var jul = new Date(this.getFullYear(), 6, 1);return Math.max(jan.getTimezoneOffset(), jul.getTimezoneOffset());};Date.prototype.dst = function() {return this.getTimezoneOffset() < this.stdTimezoneOffset();};var today = new Date();var timeZoneOffset = 0;if (today.dst()) {timeZoneOffset = today.getTimezoneOffset();} else {timeZoneOffset = today.getTimezoneOffset()-60;};$('input[name=user_timezone]').val(((timeZoneOffset)/60) * -1);});</script><?php  $tosVariable = 'tos_visible_in_page_widget';$tosCheckedVariable = 'tos_checked_online';?><?php  if (isset($start_data_fields[$tosVariable]) && $start_data_fields[$tosVariable] == true) : $hasExtraField = true;?><div class="form-group<?php  if (isset($errors['accept_tos'])) : ?> has-error<?php  endif;?>"><label class="control-label"><input type="checkbox" <?php  echo $input_data->accept_tos == true || ((!isset($_POST) || empty($_POST)) && isset($start_data_fields[$tosCheckedVariable]) && $start_data_fields[$tosCheckedVariable] == true) ? 'checked="checked"' : '';?> name="AcceptTOS" value="on">&nbsp;Acepto que mi datos personales sean tratados de acuerdo a&nbsp;<a target="_blank" href="#">nuestras condiciones y la ley vigente</a></label></div><?php  endif; ?><?php  if ($hasExtraField == true || $canReopen == true) : ?><div class="btn-group" role="group" aria-label="..."><?php  if ($hasExtraField === true) : ?><input type="submit" class="btn btn-default btn-sm" value="Iniciar chat" name="StartChatAction" /><?php  endif;?><?php   ?><?php  if ( $canReopen == true ) : ?><input type="button" class="btn btn-default btn-sm"  value="Reanudar el chat" onclick="document.location = '/chat/lhc_web/index.php/esp/chat/reopen/<?php  echo $reopenData['id']?>/<?php  echo $reopenData['hash']?>/(mode)/widget<?php  if ( isset($append_mode) && $append_mode != '' ) : ?>/(embedmode)/embed<?php  endif;?><?php  echo $append_mode_theme?>'"><?php  endif; ?></div><?php  endif;?><input type="hidden" value="<?php  echo htmlspecialchars($referer);?>" name="URLRefer" /><input type="hidden" value="<?php  echo htmlspecialchars($referer_site);?>" name="r" /><input type="hidden" value="<?php  echo htmlspecialchars($input_data->operator);?>" name="operator" /><input type="hidden" value="1" name="StartChat"/><?php  if ($hasExtraField === true) : ?><input type="hidden" value="1" id="hasFormExtraField"/><?php  endif;?></form><?php  if ($leaveamessage == true && (int)'1' == 1) : ?><div id="offline-modal" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h4 class="modal-title" id="myModalLabel">El departamento esta fuera de línea</h4></div><div class="modal-body"><div class="btn-group" role="group" aria-label="..."><a href="#" class="btn btn-default btn-xs" title="Ir a formulario para dejar un mensaje" onclick="return lhinst.switchToOfflineForm();">Deje un mensaje</a><a href="#" class="btn btn-default btn-xs" title="Cancelar y seleccionar otro departamento" onclick="closeRevealForm();return $('#offline-modal').modal('hide');">Cancelar</a></div></div></div></div></div><script>function closeRevealForm() {$('#id_DepartamentID').find('option').removeAttr('selected');$('#id_DepartamentID').find("[data-attr-online='true']").attr('selected','selected');};$('#id_DepartamentID').change(function() {if ( $(this).find('option:selected').attr('data-attr-online') == 'false' ) {$('#offline-modal').modal({'show':true,keyboard:false,backdrop: 'static'});};});$(document).ready(function() {if ( $('#id_DepartamentID').find('option:selected').attr('data-attr-online') == 'false' ) {$('#offline-modal').modal({'show':true,keyboard:false,backdrop: 'static'});};});</script><?php  endif;?><?php  if ($hasExtraField === false) : ?><script><?php  if ($canReopen == false) : ?>jQuery('#id_Question').addClass('mb0');<?php  endif;?><?php  if ($hasExtraField == false && isset($start_data_fields['message_auto_start']) && $start_data_fields['message_auto_start'] == true && isset($start_data_fields['message_auto_start_key_press']) && $start_data_fields['message_auto_start_key_press'] == true) : ?>$('#id_Question').on('keydown', function (e) {if ($( "#form-start-chat").attr("key-up-started") != 1) {$( "#form-start-chat").attr("key-up-started",1);$( "#form-start-chat").submit();}});<?php  endif;?>var formSubmitted = false;jQuery('#id_Question').bind('keydown', 'return', function (evt){if (formSubmitted == false) {$( "#form-start-chat" ).submit();<?php  if (!isset($start_data_fields['message_auto_start']) || $start_data_fields['message_auto_start'] == false) : ?>formSubmitted = true;jQuery('#id_Question').attr('readonly','readonly');<?php  endif;?>};return false;});</script><?php  endif;?><?php  else : ?><?php  if (isset($start_data_fields['show_operator_profile']) && $start_data_fields['show_operator_profile'] == true) : ?><div class="pl10 pos-rel max-width-180 pull-right"><?php  $rightLanguage = true;?><?php  if ((int)'0' == 1) : ?><?php   $enabledLanguages = explode(',','eng,lit,hrv,esp,por,nld,ara,ger,pol,rus,ita,fre,chn,cse,nor,tur,vnm,idn,sve,per,ell,dnk,rou,bgr,tha,geo,fin,alb'); $langArray = array( 'eng' => 'English', 'lit' => 'Lietuviškai', 'hrv' => 'Croatian', 'esp' => 'Spanish', 'por' => 'Portuguese', 'nld' => 'Dutch', 'ara' => 'Arabic', 'ger' => 'German', 'pol' => 'Polish', 'rus' => 'Russian', 'ita' => 'Italian', 'fre' => 'Français', 'chn' => 'Chinese', 'cse' => 'Czech', 'nor' => 'Norwegian', 'tur' => 'Turkish', 'vnm' => 'Vietnamese', 'idn' => 'Indonesian', 'sve' => 'Swedish', 'per' => 'Persian', 'ell' => 'Greek', 'dnk' => 'Danish', 'rou' => 'Romanian', 'bgr' => 'Bulgarian', 'tha' => 'Thai', 'geo' => 'Georgian', 'fin' => 'Finnish', 'alb' => 'Albanian', ); ?><div class="btn-group pull-right" role="group"><button type="button" class="btn btn-default btn-xs dropdown-toggle" title="Seleccione su lenguaje." data-toggle="dropdown" aria-expanded="false"><i class="material-icons mr-0">language</i><span class="caret"></span></button><ul class="dropdown-menu f-dropdown-lang" role="menu"><?php  foreach ($enabledLanguages as $siteAccess) : ?><li><a onclick="return lhinst.switchLang($('#form-start-chat'),'<?php  echo $siteAccess?>')" href="#"><?php  echo $langArray[$siteAccess]?></a><?php  endforeach;?></ul></div><?php  endif;?></div><?php  endif;?><?php  if (isset($errors)) : ?><?php  if (isset($errors)) : ?><div data-alert class="alert alert-danger alert-dismissible fade in"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><ul class="validation-ul"><?php  foreach ($errors as $err) : ?><li><?php  echo $err?></li><?php  endforeach;?></ul></div><?php  endif;?><?php  endif; ?><?php  $chat_part_offline_form_enabled = true;?><?php  if ($chat_part_offline_form_enabled == true) : ?><p><b><?php  if (isset($theme) && $theme !== false && $theme->noonline_operators_offline) : ?><?php  echo htmlspecialchars($theme->noonline_operators_offline)?><?php  else : ?>No hay operadores en línea en este momento, por favor deje un mensaje<?php  endif;?></b></p><?php  if (isset($request_send)) : $msg = 'Su solicitud ha sido enviada!';?><div role="alert" class="alert alert-success alert-dismissible fade in"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><?php  echo $msg?></div><script>setTimeout(function(){lhinst.userclosedchatembed();},5000);</script><?php  else : ?><form enctype="multipart/form-data" method="post" id="form-start-chat" action="/chat/lhc_web/index.php/esp/chat/chatwidget/(offline)/true/(leaveamessage)/true<?php  echo $append_mode?><?php  $department !== false ? print '/(department)/'.$department : ''?><?php  $input_data->chatprefill !== '' ? print '/(chatprefill)/'.htmlspecialchars($input_data->chatprefill) : ''?><?php  echo $append_mode_theme?>" onsubmit="return lhinst.addCaptcha('<?php  echo time()?>',$(this))"><div class="row"><?php  if (isset($start_data_fields['offline_name_visible_in_page_widget']) && $start_data_fields['offline_name_visible_in_page_widget'] == true) : ?><?php  if (isset($start_data_fields['offline_name_hidden']) && $start_data_fields['offline_name_hidden'] == true) : ?><input type="hidden" name="Username" value="<?php  echo htmlspecialchars($input_data->username);?>" /><?php  else : ?><div class="col-xs-6 form-group<?php  if (isset($errors['nick'])) : ?> has-error<?php  endif;?>"><label class="control-label">Nombre<?php  if (isset($start_data_fields['offline_name_require_option']) && $start_data_fields['offline_name_require_option'] == 'required') : ?>*<?php  endif;?></label><input class="form-control"  type="text" name="Username" value="<?php  echo htmlspecialchars($input_data->username);?>" /></div><?php  endif;?><?php  endif;?><?php  if (isset($start_data_fields['offline_email_hidden']) && $start_data_fields['offline_email_hidden'] == true) : ?><input type="hidden" name="Email" value="<?php  echo htmlspecialchars($input_data->email);?>" /><?php  else : ?><div class="col-xs-6 form-group<?php  if (isset($errors['email'])) : ?> has-error<?php  endif;?>"><label class="control-label">E-mail*</label><input class="form-control" type="text" name="Email" value="<?php  echo htmlspecialchars($input_data->email);?>" /></div><?php  endif;?></div><?php  if (isset($start_data_fields['offline_phone_visible_in_page_widget']) && $start_data_fields['offline_phone_visible_in_page_widget'] == true) : ?><?php  if (isset($start_data_fields['offline_phone_hidden']) && $start_data_fields['offline_phone_hidden'] == true) : ?><input type="hidden" name="Phone" value="<?php  echo htmlspecialchars($input_data->phone);?>" /><?php  else : ?><div class="form-group<?php  if (isset($errors['phone'])) : ?> has-error<?php  endif;?>"><label class="control-label">Teléfono<?php  if (isset($start_data_fields['offline_phone_require_option']) && $start_data_fields['offline_phone_require_option'] == 'required') : ?>*<?php  endif;?></label><input class="form-control" type="text" name="Phone" value="<?php  echo htmlspecialchars($input_data->phone);?>" /></div><?php  endif; ?><?php  endif; ?><?php  if (isset($start_data_fields['offline_file_visible_in_page_widget']) && $start_data_fields['offline_file_visible_in_page_widget'] == true) : ?><div class="form-group"><label class="control-label">Archivo</label><input type="file" name="File" value="" /></div><?php  endif; ?><?php  if (isset($start_data_fields['offline_message_visible_in_page_widget']) && $start_data_fields['offline_message_visible_in_page_widget'] == true) : ?><?php  if (isset($start_data_fields['offline_message_hidden']) && $start_data_fields['offline_message_hidden'] == true) : ?><textarea class="hide" placeholder="Ingrese su mensaje" name="Question"><?php  echo htmlspecialchars($input_data->question);?></textarea><?php  else : ?><div class="form-group<?php  if (isset($errors['question'])) : ?> has-error<?php  endif;?>"><label class="control-label">Su pregunta<?php  if (isset($start_data_fields['offline_message_require_option']) && $start_data_fields['offline_message_require_option'] == 'required') : ?>*<?php  endif;?></label><textarea class="form-control" placeholder="Ingrese su mensaje" name="Question"><?php  echo htmlspecialchars($input_data->question);?></textarea></div><?php  endif; ?><?php  endif; ?><?php  $adminCustomFieldsMode = 'off';?><?php   if (isset($start_data_fields['custom_fields']) && $start_data_fields['custom_fields'] != '') : $customAdminfields = json_decode($start_data_fields['custom_fields'],true); if (is_array($customAdminfields)) : ?><div class="row"><?php  foreach ($customAdminfields as $key => $adminField) : if ($adminField['visibility'] == 'all' || $adminCustomFieldsMode == $adminField['visibility']) : ?><?php  if ($adminField['fieldtype'] == 'hidden' || (isset($input_data->via_hidden[$key]) && $input_data->via_hidden[$key] == 't')) : ?><?php  if (isset($input_data->via_hidden[$key]) && $input_data->via_hidden[$key] == 't') : ?><input class="form-control" type="hidden" name="via_hidden[<?php  echo $key?>]" value="t" /><?php  endif;?><?php  if (isset($input_data->via_encrypted[$key]) && $input_data->via_encrypted[$key] == 't') : ?><input class="form-control" type="hidden" name="via_encrypted[<?php  echo $key?>]" value="t" /><?php  endif;?><input class="form-control" type="hidden" name="value_items_admin[<?php  echo $key?>]" value="<?php  isset($input_data->value_items_admin[$key]) ? print htmlspecialchars($input_data->value_items_admin[$key]) : print htmlspecialchars($adminField['defaultvalue'])?>" /><?php  else : $hasExtraField = true; ?><div class="col-xs-<?php  echo htmlspecialchars($adminField['size'])?>"><div class="form-group<?php  if (isset($errors['additional_admin_'.$key])) : ?> has-error<?php  endif;?>"><label class="control-label"><?php  echo htmlspecialchars($adminField['fieldname'])?>&nbsp;<?php  $adminField['isrequired'] == 'true' ? print '*' : ''?></label><input class="form-control" type="text" name="value_items_admin[<?php  echo $key?>]" value="<?php  isset($input_data->value_items_admin[$key]) ? print htmlspecialchars($input_data->value_items_admin[$key]) : print htmlspecialchars($adminField['defaultvalue'])?>" /></div></div><?php  endif; endif; endforeach;?></div><?php  endif; endif;?><?php  $modeUserVariables = 'off'; ?><?php   $modeUserVariables = isset($modeUserVariables) ? $modeUserVariables : 'on'; if (!empty($input_data->name_items)) { $hasExtraField = true; }; foreach ($input_data->name_items as $item) : ?><input type="hidden" name="name_items[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;?><?php  if (isset($input_data->value_sizes)) : foreach ($input_data->value_sizes as $item) : ?><input type="hidden" name="value_sizes[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;endif;?><?php  if (isset($input_data->values_req)) : foreach ($input_data->values_req as $item) : ?><input type="hidden" name="values_req[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;endif;?><?php  if (isset($input_data->value_show)) : foreach ($input_data->value_show as $item) : ?><input type="hidden" name="value_show[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;endif;?><?php  if (isset($input_data->hattr)) : foreach ($input_data->hattr as $item) : ?><input type="hidden" name="hattr[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;endif;?><?php  if (isset($input_data->encattr)) : foreach ($input_data->encattr as $item) : ?><input type="hidden" name="encattr[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;endif;?><?php $hasVisibleField = false; foreach ($input_data->value_types as $key => $item) : $showField = ($input_data->value_show[$key] == $modeUserVariables || $input_data->value_show[$key] == 'b'); ($hasVisibleField = ($item == 'text' && $showField == true) ? true : $hasVisibleField); ?><input type="hidden" name="value_types[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;?><?php  if ($hasVisibleField == true) : ?><div class="row"><?php  endif;?><?php  foreach ($input_data->value_items as $key => $item) : $showField = ($input_data->value_show[$key] == $modeUserVariables || $input_data->value_show[$key] == 'b'); $visibleItem = (isset($input_data->value_types[$key]) && $input_data->value_types[$key] == 'text' && isset($input_data->name_items[$key])); ?><?php  if ($visibleItem == true && $showField == true) : ?><div class="form-group col-xs-<?php  isset($input_data->value_sizes[$key]) ? print (int)$input_data->value_sizes[$key] : print 6?><?php  if (isset($errors['additional_'.$key])) : ?> has-error<?php  endif;?>"><label class="control-label"><?php  echo htmlspecialchars($input_data->name_items[$key])?><?php  isset($input_data->values_req[$key]) && $input_data->values_req[$key] == 't' ? print '*' : ''?></label><?php  endif;?><input class="form-control" type="<?php  isset($input_data->value_types[$key]) && $showField == true ? print htmlspecialchars($input_data->value_types[$key]) : print 'hidden' ?>" name="value_items[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  if ($visibleItem == true && $showField == true) : ?></div><?php  endif;?><?php  endforeach;?><?php  if ($hasVisibleField == true) : ?></div><?php  endif;?><?php  if ($department === false) : ?><?php   $filter = array('filter' => array('disabled' => 0, 'hidden' => 0)); if (isset($input_data->departament_id_array)) { $filter['filterin']['id'] = $input_data->departament_id_array; } $filter['sort'] = 'sort_priority ASC, name ASC'; $departments = erLhcoreClassModelDepartament::getList($filter); if (count($departments) > 1) : $hasExtraField = true;?><?php  if (isset($input_data->departament_id_array)) : foreach ($input_data->departament_id_array as $definedDep) : ?><input type="hidden" name="DepartmentIDDefined[]" value="<?php  echo $definedDep?>" /><?php  endforeach; endif; ?><?php  if (!isset($departmentsOptions['hide_department']) || $departmentsOptions['hide_department'] == false) : ?><div class="form-group<?php  if (isset($errors['department'])) : ?> has-error<?php  endif;?>"><label class="control-label"><?php  if (isset($theme) && $theme !== false && $theme->department_title != '') : ?><?php  echo htmlspecialchars($theme->department_title)?><?php  else : ?>Departamento<?php  endif;?></label><select class="form-control" name="DepartamentID" id="id_DepartamentID"><?php  if (isset($theme) && $theme !== false && $theme->department_select != '') : ?><option value="-1"><?php  echo htmlspecialchars($theme->department_select)?></option><?php  endif;?><?php  $departments = erLhcoreClassDepartament::sortByStatus($departments); foreach ($departments as $departament) : $isOnline = erLhcoreClassChat::isOnline($departament->id,false,array('ignore_user_status'=> (int)'0', 'online_timeout' => (int)'300')); ?><?php  if (($departament->visible_if_online == 1 && $isOnline === true) || $departament->visible_if_online == 0) : ?><option data-attr-online="<?php  if ($isOnline === false) : ?>false<?php  else : ?>true<?php  endif;?>" <?php  if ($isOnline === false) : ?>class="offline-dep"<?php  endif;?> value="<?php  echo $departament->id?>" <?php  isset($input_data->departament_id) && $input_data->departament_id == $departament->id ? print 'selected="selected"' : '';?> ><?php  echo htmlspecialchars($departament->name)?><?php  if ($isOnline === false) : ?>&nbsp;&nbsp;--=Desconectado=--<?php  endif;?></option><?php  endif;?><?php  endforeach; ?></select></div><?php  endif; endif; ?><?php  endif;?><?php  $tosVariable = 'offline_tos_visible_in_page_widget';$tosCheckedVariable = 'tos_checked_offline';?><?php  if (isset($start_data_fields[$tosVariable]) && $start_data_fields[$tosVariable] == true) : $hasExtraField = true;?><div class="form-group<?php  if (isset($errors['accept_tos'])) : ?> has-error<?php  endif;?>"><label class="control-label"><input type="checkbox" <?php  echo $input_data->accept_tos == true || ((!isset($_POST) || empty($_POST)) && isset($start_data_fields[$tosCheckedVariable]) && $start_data_fields[$tosCheckedVariable] == true) ? 'checked="checked"' : '';?> name="AcceptTOS" value="on">&nbsp;Acepto que mi datos personales sean tratados de acuerdo a&nbsp;<a target="_blank" href="#">nuestras condiciones y la ley vigente</a></label></div><?php  endif; ?><div class="btn-group" role="group" aria-label="..."><input type="submit" class="btn btn-default btn-sm" value="Deje un mensaje" name="StartChatAction" /><?php   ?><?php  if ( '1' == 1 && ($reopenData = erLhcoreClassChat::canReopenDirectly(array('reopen_closed' => '1'))) !== false ) : ?><input type="button" class="btn btn-default btn-sm"  value="Reanudar el chat" onclick="document.location = '/chat/lhc_web/index.php/esp/chat/reopen/<?php  echo $reopenData['id']?>/<?php  echo $reopenData['hash']?>/(mode)/widget<?php  if ( isset($append_mode) && $append_mode != '' ) : ?>/(embedmode)/embed<?php  endif;?>'"><?php  endif; ?></div><input type="hidden" value="<?php  echo htmlspecialchars($referer);?>" name="URLRefer"/><input type="hidden" value="1" name="StartChat"/></form><?php  endif;?><?php  else : ?><?php   $errors = array('Offline form is disabled'); ?><?php  if (isset($errors)) : ?><div data-alert class="alert alert-danger alert-dismissible fade in"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><ul class="validation-ul"><?php  foreach ($errors as $err) : ?><li><?php  echo $err?></li><?php  endforeach;?></ul></div><?php  endif;?><?php  endif;?><?php  endif;?><?php  endif;?>